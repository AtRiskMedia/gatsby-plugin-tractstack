{"version":3,"file":"build-controller.js","names":["React","renderToStaticMarkup","styled","Link","useKeenSlider","SvgShape","SvgPlay","SvgRewind","TractStackLogo","lispCallback","StyledWrapperDiv","InjectCssAnimation","lispLexer","BuildController","data","next","prev","link","svgString","b64","dataUri","css","mask_css","react_fragment","effects_payload","controller_pane","controller_pane_minimized","storyStep","storyStepGraph","field_slug","previous","viewport","shape","window","btoa","injectPayloadMinimize","payload","payload_ast","hookEndPoint","injectPayloadExpand","prefersReducedMotion","in","animateController","animateControllerExpand","animateControllerMinimize","icons","key","refCallback","slider","sliderNode","loop","mode","breakpoints","slides","perView","spacing","timeout","mouseOver","clearNextTimeout","clearTimeout","nextTimeout","setTimeout","on","container","addEventListener","current","id"],"sources":["src/build-controller.js"],"sourcesContent":["import React from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport styled from \"styled-components\";\nimport { Link } from \"gatsby\";\nimport \"keen-slider/keen-slider.min.css\";\nimport { useKeenSlider } from \"keen-slider/react\";\nimport { SvgShape, SvgPlay, SvgRewind, TractStackLogo } from \"./shapes\";\nimport { lispCallback, StyledWrapperDiv, InjectCssAnimation } from \"./helpers\";\nimport { lispLexer } from \"./lexer\";\n\nfunction BuildController(data) {\n  let next,\n    prev,\n    link,\n    svgString,\n    b64,\n    dataUri,\n    css,\n    mask_css,\n    react_fragment,\n    effects_payload,\n    controller_pane,\n    controller_pane_minimized;\n  if (data?.storyStep?.storyStepGraph?.next?.field_slug)\n    next = `/${data?.storyStep?.storyStepGraph?.next?.field_slug}`;\n  if (data?.storyStep?.storyStepGraph?.previous?.field_slug)\n    prev = `/${data?.storyStep?.storyStepGraph?.previous?.field_slug}`;\n  controller_pane = SvgShape(\"controller\", {\n    viewport: data?.viewport?.viewport,\n  }).shape;\n  controller_pane_minimized = SvgShape(\"mini\", {\n    viewport: data?.viewport?.viewport,\n  }).shape;\n\n  svgString = renderToStaticMarkup(controller_pane_minimized);\n  b64 = window.btoa(svgString);\n  dataUri = `data:image/svg+xml;base64,${b64}`;\n  mask_css =\n    `#controller-container-minimized {-webkit-mask-image: url(\"${dataUri}\"); mask-image: url(\"${dataUri}\");` +\n    ` mask-repeat: no-repeat; -webkit-mask-size: 100% AUTO; mask-size: 100% AUTO; }`;\n\n  svgString = renderToStaticMarkup(controller_pane);\n  b64 = window.btoa(svgString);\n  dataUri = `data:image/svg+xml;base64,${b64}`;\n  mask_css =\n    `${mask_css} #controller-container-expanded {-webkit-mask-image: url(\"${dataUri}\"); mask-image: url(\"${dataUri}\");` +\n    ` mask-repeat: no-repeat; -webkit-mask-size: 100% AUTO; mask-size: 100% AUTO; }`;\n\n  /*\n  <div className=\"controller__graph\">\n    {next ? (\n      <a onClick={() => data?.hooks?.hookGotoStoryFragment(next)}>\n        <SvgPlay />\n      </a>\n    ) : (\n      \"\"\n    )}\n    {prev ? (\n      <a onClick={() => data?.hooks?.hookGotoStoryFragment(prev)}>\n        <SvgRewind />\n      </a>\n    ) : (\n      \"\"\n    )}\n  </div>\n  */\n  function injectPayloadMinimize() {\n    let payload = \"(controller (minimize))\";\n    let payload_ast = lispLexer(payload);\n    lispCallback(payload_ast[0], \"controller\", data?.hookEndPoint);\n  }\n\n  function injectPayloadExpand() {\n    let payload = \"(controller (expand))\";\n    let payload_ast = lispLexer(payload);\n    lispCallback(payload_ast[0], \"controller\", data?.hookEndPoint);\n  }\n\n  // can we wrap this in animation?\n  if (data?.prefersReducedMotion?.prefersReducedMotion === false) {\n    effects_payload = {\n      in: [\"fadeInRight\", 0.65, 0],\n    };\n    let animateController = InjectCssAnimation(effects_payload, \"controller\");\n    effects_payload = {\n      in: [\"pulseExpand\", 2, 10],\n    };\n    let animateControllerExpand = InjectCssAnimation(\n      effects_payload,\n      \"controller-expand\"\n    );\n    let animateControllerMinimize = InjectCssAnimation(\n      effects_payload,\n      \"controller-minimize\"\n    );\n    css = `${animateController} ${animateControllerExpand} ${animateControllerMinimize}`;\n  }\n  css = `${css} ${mask_css}`;\n  let icons = `controller__icons controller__icons--${data?.viewport?.viewport?.key}`; // to-do\n\n  const [refCallback, slider, sliderNode] = useKeenSlider(\n    {\n      loop: true,\n      mode: \"free-snap\",\n\n      breakpoints: {\n        \"(min-width: 601px)\": {\n          slides: { perView: 3, spacing: 4 },\n        },\n        \"(min-width: 1367px)\": {\n          slides: { perView: 5, spacing: 6 },\n        },\n      },\n      slides: { perView: 2 },\n    },\n    [\n      (slider) => {\n        let timeout;\n        let mouseOver = false;\n        function clearNextTimeout() {\n          clearTimeout(timeout);\n        }\n        function nextTimeout() {\n          clearTimeout(timeout);\n          if (mouseOver) return;\n          timeout = setTimeout(() => {\n            slider.next();\n          }, 22000);\n        }\n        slider.on(\"created\", () => {\n          slider.container.addEventListener(\"mouseover\", () => {\n            mouseOver = true;\n            clearNextTimeout();\n          });\n          slider.container.addEventListener(\"mouseout\", () => {\n            mouseOver = false;\n            nextTimeout();\n          });\n          nextTimeout();\n        });\n        slider.on(\"dragStarted\", clearNextTimeout);\n        slider.on(\"animationEnded\", nextTimeout);\n        slider.on(\"updated\", nextTimeout);\n      },\n    ]\n  );\n\n  return (\n    <>\n      <StyledWrapperDiv\n        css={css}\n        key={data?.storyStep?.storyStepGraph?.current?.id}\n        id=\"controller-container\"\n      >\n        <div\n          id=\"controller-container-expanded\"\n          className={`controller__container--${data?.viewport?.viewport?.key}`}\n        >\n          <div\n            className=\"controller__container--minimize\"\n            onClick={() => injectPayloadMinimize()}\n            title=\"Minimize the Controller\"\n          >\n            <div>&lt;</div>\n          </div>\n          <div\n            className=\"controller__container--carousel keen-slider\"\n            ref={refCallback}\n          >\n            <div className=\"keen-slider__slide a\">1</div>\n            <div className=\"keen-slider__slide b\">2</div>\n            <div className=\"keen-slider__slide c\">3</div>\n          </div>\n          <div className={icons}>\n            <ul className={icons} id=\"controller-expanded-icons\"></ul>\n          </div>\n        </div>\n        <div\n          id=\"controller-container-minimized\"\n          className={`controller__container--${data?.viewport?.viewport?.key}`}\n        >\n          <div className={icons}>\n            <ul id=\"controller-minimized-icons\"></ul>\n          </div>\n          <div\n            className=\"controller__container--expand\"\n            onClick={() => injectPayloadExpand()}\n            title=\"Toggle Full Controller\"\n          >\n            <div>&gt;</div>\n          </div>\n        </div>\n      </StyledWrapperDiv>\n    </>\n  );\n}\n\nexport { BuildController };\n"],"mappings":"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"}