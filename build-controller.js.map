{"version":3,"file":"build-controller.js","names":["React","renderToStaticMarkup","styled","Link","SvgShape","SvgPlay","SvgRewind","TractStackLogo","lispCallback","StyledWrapperDiv","InjectCssAnimation","lispLexer","BuildController","data","next","prev","link","react_fragment","effects_payload","controller_pane","controller_pane_minimized","state","storyStep","storyStepGraph","field_slug","previous","viewport","shape","svgString","b64","window","btoa","dataUri","css","mask_css","payload","payload_ast","injectPayloadExpand","hookEndPoint","prefersReducedMotion","in","animateController","animateControllerExpand","current","id"],"sources":["src/build-controller.js"],"sourcesContent":["import React from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport styled from \"styled-components\";\nimport { Link } from \"gatsby\";\nimport { SvgShape, SvgPlay, SvgRewind, TractStackLogo } from \"./shapes\";\nimport { lispCallback, StyledWrapperDiv, InjectCssAnimation } from \"./helpers\";\nimport { lispLexer } from \"./lexer\";\n\nfunction BuildController(data) {\n  let next,\n    prev,\n    link,\n    react_fragment,\n    effects_payload,\n    controller_pane,\n    controller_pane_minimized;\n  if (data?.state?.storyStep?.storyStepGraph?.next?.field_slug)\n    next = `/${data?.state?.storyStep?.storyStepGraph?.next?.field_slug}`;\n  if (data?.state?.storyStep?.storyStepGraph?.previous?.field_slug)\n    prev = `/${data?.state?.storyStep?.storyStepGraph?.previous?.field_slug}`;\n  controller_pane = SvgShape(\"controller\", {\n    viewport: data?.state?.viewport?.viewport,\n  }).shape;\n  controller_pane_minimized = SvgShape(\"mini\", {\n    viewport: data?.state?.viewport?.viewport,\n  }).shape;\n\n  let svgString = renderToStaticMarkup(controller_pane_minimized);\n  let b64 = window.btoa(svgString);\n  let dataUri = `data:image/svg+xml;base64,${b64}`;\n  let css,\n    mask_css =\n      `.controller__container {-webkit-mask-image: url(\"${dataUri}\"); mask-image: url(\"${dataUri}\");` +\n      ` mask-repeat: no-repeat; -webkit-mask-size: 100% AUTO; mask-size: 100% AUTO; }`;\n\n  /*\n  <div className=\"controller__graph\">\n    {next ? (\n      <a onClick={() => data?.hooks?.hookGotoStoryFragment(next)}>\n        <SvgPlay />\n      </a>\n    ) : (\n      \"\"\n    )}\n    {prev ? (\n      <a onClick={() => data?.hooks?.hookGotoStoryFragment(prev)}>\n        <SvgRewind />\n      </a>\n    ) : (\n      \"\"\n    )}\n  </div>\n  */\n  let payload = \"(controller (expand))\";\n  let payload_ast = lispLexer(payload);\n  function injectPayloadExpand() {\n    lispCallback(payload_ast[0], \"controller\", data?.hookEndPoint);\n  }\n\n  // can we wrap this in animation?\n  if (data?.state?.prefersReducedMotion?.prefersReducedMotion === false) {\n    effects_payload = {\n      in: [\"fadeInRight\", 2, 1],\n    };\n    let animateController = InjectCssAnimation(effects_payload, \"controller\");\n    effects_payload = {\n      in: [\"pulseExpand\", 2, 10],\n    };\n    let animateControllerExpand = InjectCssAnimation(\n      effects_payload,\n      \"controller-expand\"\n    );\n    css = `${animateController} ${animateControllerExpand}`;\n  }\n  css = `${css} ${mask_css}`;\n\n  return (\n    <>\n      <section\n        key={data?.state?.storyStep?.storyStepGraph?.current?.id}\n        id=\"controller\"\n      >\n        <StyledWrapperDiv css={css}>\n          <div id=\"controller-expanded\">{controller_pane}</div>\n          <div id=\"controller-minimized\">\n            <div className=\"controller\">\n              <div className=\"controller__container\">\n                {controller_pane_minimized}\n              </div>\n              <div className=\"controller__container\">\n                <div className=\"controller__container--expand-bg\">&gt;</div>\n              </div>\n              <div className=\"controller__container\">\n                <div className=\"controller__container--expand\">\n                  <a\n                    href=\"#\"\n                    onClick={() => injectPayloadExpand()}\n                    title=\"Toggle Full Controller\"\n                  >\n                    &nbsp;\n                  </a>\n                </div>\n              </div>\n            </div>\n          </div>\n        </StyledWrapperDiv>\n      </section>\n    </>\n  );\n}\n\nexport { BuildController };\n"],"mappings":"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"}