{"version":3,"file":"build-menu.js","names":["React","GatsbyImage","lispCallback","StyledWrapperDiv","InjectCssAnimation","lispLexer","CountChildrenOffset","items","index","level","next","field_level","length","PreParseMenuItems","useHookEndPoint","options","map","e","JSON","parse","field_options","SyntaxError","console","log","callbackPayload","ParseMenuItems","recurse","payload_ast","injectPayload","this_menu_item","field_title","this_level","sub","skip_children"],"sources":["src/build-menu.js"],"sourcesContent":["import React from \"react\";\nimport { GatsbyImage } from \"gatsby-plugin-image\";\nimport { lispCallback, StyledWrapperDiv, InjectCssAnimation } from \"./helpers\";\nimport { lispLexer } from \"./lexer\";\n\nfunction CountChildrenOffset(items, index = 0, level = 0) {\n  while (1) {\n    let next = items[index + 1] && items[index + 1]?.field_level;\n    index = index + 1;\n    if (index + 1 === items.length && items[index]?.field_level === level) {\n      return index;\n    }\n    if (next === level) {\n      return index;\n    }\n    if (index > items.length) {\n      return false;\n    }\n  }\n}\n\nfunction PreParseMenuItems(items, useHookEndPoint) {\n  // pre-parses menu items and injects hooks, if any\n  let options;\n  return items?.map((e) => {\n    try {\n      options = JSON.parse(e?.field_options);\n    } catch (e) {\n      if (e instanceof SyntaxError) {\n        console.log(\"ERROR parsing json in {}: \", e);\n      }\n    }\n    if (typeof options?.callbackPayload === \"string\") {\n      e.callbackPayload = options.callbackPayload;\n      e.useHookEndPoint = useHookEndPoint;\n    } else {\n      e.callbackPayload = false;\n      e.useHookEndPoint = false;\n    }\n    return e;\n  });\n}\n\nfunction ParseMenuItems(items, index = 0, level = 0) {\n  if (typeof items === \"undefined\") return <></>;\n  let recurse;\n  let payload_ast = lispLexer(items[index]?.callbackPayload);\n  function injectPayload() {\n    lispCallback(payload_ast[0], \"\", items[index]?.useHookEndPoint);\n  }\n  let this_menu_item = (\n    <a key={index} href=\"#\" onClick={() => injectPayload()}>\n      {items[index]?.field_title}\n    </a>\n  );\n\n  if (index === 0 && level === 0) {\n    // initial bootstrap of menu ul\n    if (items.length) recurse = ParseMenuItems(items, 0, 1);\n    return <ul>{recurse}</ul>;\n  }\n  if (level) {\n    let this_level = items[index]?.field_level - level;\n    let next =\n      items[index + 1] &&\n      items[index + 1]?.field_level - items[index]?.field_level;\n\n    if (next === 0) {\n      recurse = ParseMenuItems(items, index + 1, level);\n      return (\n        <>\n          <li>{this_menu_item}</li> {recurse}\n        </>\n      );\n    } else if (next === -1 || typeof next === \"undefined\") {\n      return <li>{this_menu_item}</li>;\n    } else if (next === 1) {\n      // smart split sub-menu from remainder\n      let sub = ParseMenuItems(items, index + 1, level);\n      let skip_children = CountChildrenOffset(\n        items,\n        index,\n        items[index]?.field_level\n      );\n      if (skip_children) {\n        recurse = ParseMenuItems(\n          items,\n          skip_children,\n          items[skip_children]?.field_level\n        );\n        return (\n          <>\n            <li>\n              {this_menu_item}\n              <ul>{sub}</ul>\n            </li>\n            {recurse}\n          </>\n        );\n      } else {\n        return (\n          <>\n            <li>\n              {this_menu_item}\n              <ul>{sub}</ul>\n            </li>\n          </>\n        );\n      }\n    }\n  }\n}\n\nexport { PreParseMenuItems, ParseMenuItems };\n"],"mappings":"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"}