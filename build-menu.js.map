{"version":3,"file":"build-menu.js","names":["React","Link","GatsbyImage","lispCallback","StyledWrapperDiv","InjectCssAnimation","lispLexer","CountChildrenOffset","items","index","level","next","field_level","length","PreParseMenuItems","hooks","options","map","e","JSON","parse","field_options","SyntaxError","console","log","callbackPayload","hooksData","ParseMenuItems","recurse","payload_ast","injectPayload","this_menu_item","field_title","this_level","sub","skip_children","BuildMenu","data","state","viewport","key","logo","payload","relationships","field_svg_logo","localFile","publicURL","this_image_id","id","this_image","field_image_logo","childImageSharp","menuItemsRaw","field_menu_items","menuItems"],"sources":["src/build-menu.js"],"sourcesContent":["import React from \"react\";\nimport { Link } from \"gatsby\";\nimport { GatsbyImage } from \"gatsby-plugin-image\";\nimport { lispCallback, StyledWrapperDiv, InjectCssAnimation } from \"./helpers\";\nimport { lispLexer } from \"./lexer\";\n\nfunction CountChildrenOffset(items, index = 0, level = 0) {\n  while (1) {\n    let next = items[index + 1] && items[index + 1]?.field_level;\n    index = index + 1;\n    if (index + 1 === items.length && items[index]?.field_level === level) {\n      return index;\n    }\n    if (next === level) {\n      return index;\n    }\n    if (index > items.length) {\n      return false;\n    }\n  }\n}\n\nfunction PreParseMenuItems(items, hooks) {\n  // pre-parses menu items and injects hooks, if any\n  let options;\n  return items?.map((e) => {\n    try {\n      options = JSON.parse(e?.field_options);\n    } catch (e) {\n      if (e instanceof SyntaxError) {\n        console.log(\"ERROR parsing json in {}: \", e);\n      }\n    }\n    if (typeof options?.callbackPayload === \"string\") {\n      e.callbackPayload = options.callbackPayload;\n      e.hooksData = hooks;\n    } else {\n      e.callbackPayload = false;\n      e.hooksData = false;\n    }\n    return e;\n  });\n}\n\nfunction ParseMenuItems(items, index = 0, level = 0) {\n  if (typeof items === \"undefined\") return <></>;\n  let recurse;\n  let payload_ast = lispLexer(items[index]?.callbackPayload);\n  function injectPayload() {\n    lispCallback(payload_ast[0], \"\", items[index]?.hooksData);\n  }\n  let this_menu_item = (\n    <a key={index} href=\"#\" onClick={() => injectPayload()}>\n      {items[index]?.field_title}\n    </a>\n  );\n\n  if (index === 0 && level === 0) {\n    // initial bootstrap of menu ul\n    if (items.length) recurse = ParseMenuItems(items, 0, 1);\n    return <ul>{recurse}</ul>;\n  }\n  if (level) {\n    let this_level = items[index]?.field_level - level;\n    let next =\n      items[index + 1] &&\n      items[index + 1]?.field_level - items[index]?.field_level;\n\n    if (next === 0) {\n      recurse = ParseMenuItems(items, index + 1, level);\n      return (\n        <>\n          <li>{this_menu_item}</li> {recurse}\n        </>\n      );\n    } else if (next === -1 || typeof next === \"undefined\") {\n      return <li>{this_menu_item}</li>;\n    } else if (next === 1) {\n      // smart split sub-menu from remainder\n      let sub = ParseMenuItems(items, index + 1, level);\n      let skip_children = CountChildrenOffset(\n        items,\n        index,\n        items[index]?.field_level\n      );\n      if (skip_children) {\n        recurse = ParseMenuItems(\n          items,\n          skip_children,\n          items[skip_children]?.field_level\n        );\n        return (\n          <>\n            <li>\n              {this_menu_item}\n              <ul>{sub}</ul>\n            </li>\n            {recurse}\n          </>\n        );\n      } else {\n        return (\n          <>\n            <li>\n              {this_menu_item}\n              <ul>{sub}</ul>\n            </li>\n          </>\n        );\n      }\n    }\n  }\n}\n\nfunction BuildMenu(data) {\n  if (!data?.state?.viewport?.viewport?.key) return <></>;\n\n  let logo;\n  // svg or image logo?\n  if (\n    typeof data?.payload?.relationships?.field_svg_logo?.localFile\n      ?.publicURL === \"string\"\n  ) {\n    // svg logo\n    let this_image_id = data?.payload?.relationships?.field_svg_logo?.id;\n    let this_image =\n      data?.payload?.relationships?.field_svg_logo?.localFile?.publicURL;\n    logo = (\n      <img\n        src={this_image}\n        className={`menu__logo menu__logo--${data?.state?.viewport?.viewport?.key}`}\n        alt=\"Logo\"\n      />\n    );\n  } else if (\n    typeof data?.payload?.relationships?.field_image_logo?.localFile\n      ?.childImageSharp[data?.state?.viewport?.viewport?.key] !== \"undefined\"\n  ) {\n    let this_image_id = data?.payload?.relationships?.field_image_logo?.id;\n    let this_image =\n      data?.payload?.relationships?.field_image_logo?.localFile\n        ?.childImageSharp[data?.state?.viewport?.viewport?.key];\n    // image logo\n    logo = (\n      <GatsbyImage\n        key={this_image_id}\n        className={`menu__logo menu__logo--${data?.state?.viewport?.viewport?.key}`}\n        alt=\"Logo\"\n        image={this_image}\n        objectFit=\"contain\"\n      />\n    );\n  }\n  let menuItemsRaw = PreParseMenuItems(\n    data?.payload?.relationships?.field_menu_items,\n    data?.hooks\n  );\n  let menuItems = ParseMenuItems(menuItemsRaw);\n\n  return (\n    <>\n      <header role=\"banner\">\n        <nav\n          role=\"navigation\"\n          className={`menu-default menu-default-${data?.state?.viewport?.viewport?.key}`}\n        >\n          <div className=\"menu__main\">\n            {logo}\n            <p>\n              <span className=\"menu__main--wordmark wordmark wordmark__ARm\">\n                At Risk Media\n              </span>\n            </p>\n            <p>\n              <span className=\"menu__main--slogan\">\n                Power-ups for creatives since 2002.\n              </span>\n            </p>\n          </div>\n          <div className=\"menu__side\">{menuItems}</div>\n        </nav>\n      </header>\n    </>\n  );\n}\n\nexport { BuildMenu };\n"],"mappings":"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"}