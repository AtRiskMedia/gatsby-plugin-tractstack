{"version":3,"sources":["src/compose-panes.js"],"names":["React","useEffect","useRef","styled","sanitize","MarkdownInjectGatsbyImage","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","gsap","StyledWrapper","div","props","css","StyledOuter","children","viewport","StyledInner","parent_css","zIndex","parseInt","ComposePanes","data","key","composedPanes","relationships","field_panes","map","pane","i","composedPane","field_pane_fragments","pane_fragment","index","react_fragment","alt_text","imageData","internal","type","field_image","image","id","filename","localFile","childImageSharp","gatsbyImageData","htmlAst","childPaneFragment","childMarkdownRemark","field_cdn_url","field_alt_text","this_image_data","field_svg_file","description","publicURL","field_zindex","field_css_styles","field_css_styles_parent","paneRef","from","current","opacity","delay"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport styled from \"styled-components\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport {\n  MarkdownInjectGatsbyImage,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n} from \"./helpers\";\nimport { gsap } from \"gsap\";\n\nconst StyledWrapper = styled.div`\n  ${(props) => props.css};\n`;\nconst StyledOuter = ({ children, viewport, css = \"\" }) => {\n  return (\n    <StyledWrapper css={css}>\n      <div className={\"storyFragment storyFragment__view--\" + viewport}>\n        {children}\n      </div>\n    </StyledWrapper>\n  );\n};\nconst StyledInner = ({ children, css = \"\", parent_css = \"\", zIndex = 100 }) => {\n  return (\n    // inject zIndex\n    <StyledWrapper\n      css={parent_css + \".paneFragment{ z-index:\" + parseInt(zIndex) + \"}\"}\n    >\n      <StyledWrapper css={css}>{children}</StyledWrapper>\n    </StyledWrapper>\n  );\n};\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.viewport?.key === \"undefined\") return <></>;\n  // loop through the panes in view and render each pane fragment\n  const composedPanes = data?.data?.relationships?.field_panes\n    // compose current pane plus lookahead\n    .map((pane, i) => {\n      const composedPane = pane?.relationships?.field_pane_fragments.map(\n        (pane_fragment, index) => {\n          let react_fragment, alt_text, imageData;\n          // switch on internal.type\n          switch (pane_fragment?.internal?.type) {\n            case \"paragraph__markdown\":\n              // get image data (if available)\n              imageData = pane_fragment?.relationships?.field_image?.map(\n                (image) => {\n                  return [\n                    image.id,\n                    image.filename,\n                    image.localFile?.childImageSharp?.gatsbyImageData,\n                  ];\n                }\n              );\n\n              // replaces images with Gatsby Images and prepares html\n              let htmlAst = sanitize(\n                pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst\n              );\n              react_fragment = MarkdownInjectGatsbyImage(htmlAst, imageData);\n              break;\n\n            case \"paragraph__background_video\":\n              react_fragment = InjectGatsbyBackgroundVideo(\n                pane_fragment?.id,\n                pane_fragment?.field_cdn_url,\n                pane_fragment?.field_alt_text\n              );\n              break;\n\n            case \"paragraph__background_image\":\n              imageData = pane_fragment?.relationships?.field_image?.map(\n                (image) => {\n                  let key = data?.viewport?.key;\n                  let this_image_data = image[key];\n                  if (typeof this_image_data !== \"undefined\") {\n                    return this_image_data.childImageSharp?.gatsbyImageData;\n                  }\n                }\n              );\n              react_fragment = InjectGatsbyBackgroundImage(\n                imageData[0],\n                pane_fragment?.field_alt_text\n              );\n              break;\n\n            case \"paragraph__svg\":\n              alt_text = pane_fragment?.field_svg_file?.description;\n              let publicURL =\n                pane_fragment?.relationships?.field_svg_file?.localFile\n                  ?.publicURL;\n              react_fragment = InjectSvg(publicURL, alt_text);\n              break;\n\n            case \"paragraph__d3\":\n              //\n              break;\n\n            case \"paragraph__h5p\":\n              //\n              break;\n          }\n          return (\n            <div\n              className={\n                \"paneFragment paneFragment__view--\" + data?.viewport?.key\n              }\n            >\n              <StyledInner\n                key={index}\n                zIndex={pane_fragment?.field_zindex}\n                css={pane_fragment?.field_css_styles}\n                parent_css={pane_fragment?.field_css_styles_parent}\n              >\n                {react_fragment}\n              </StyledInner>\n            </div>\n          );\n        }\n      );\n      let paneRef = useRef();\n      useEffect(() => {\n        gsap.from(paneRef.current, 1, { opacity: 0, delay: 0 });\n      });\n      return (\n        <div\n          key={i}\n          className={\"pane pane__view--\" + data?.viewport?.key}\n          ref={paneRef}\n        >\n          {composedPane}\n        </div>\n      );\n    });\n  return (\n    <StyledOuter css={data?.parent_css} viewport={data?.viewport?.key}>\n      {composedPanes}\n    </StyledOuter>\n  );\n}\n\nexport { ComposePanes };\n"],"file":"compose-panes.js"}