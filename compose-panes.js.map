{"version":3,"file":"compose-panes.js","names":["React","useRef","renderToStaticMarkup","animateScrollTo","IsVisible","MarkdownParagraph","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","InjectSvgShape","InjectSvgModal","StyledWrapperDiv","InjectCssAnimation","getCurrentPane","thisViewportValue","SvgPane","SvgModal","ComposePanes","data","state","viewport","key","visiblePane","currentPane","panes","ref","document","getElementById","composedPanes","fragments","relationships","field_panes","map","pane","i","css","imageMaskShapes","textShapeOutsides","background_colour","field_pane_fragments","filter","e","internal","type","this_selector","shape","pane_height","mobile","field_height_ratio_mobile","tablet","field_height_ratio_tablet","desktop","field_height_ratio_desktop","height_offset","field_height_offset_mobile","field_height_offset_tablet","field_height_offset_desktop","imageMaskShapeSelector","this_pane","field_image_mask_shape_mobile","field_image_mask_shape_tablet","field_image_mask_shape_desktop","console","log","selector","paneFragment","id","Boolean","composedPaneFragments","field_hidden_viewports","replace","split","indexOf","sort","a","b","field_zindex","pane_fragment","index","react_fragment","tractStackFragment","child","action","child_payload","maskData","buttonData","videoData","imageData","css_child","css_parent","field_css_styles_mobile","field_css_styles_tablet","field_css_styles_desktop","field_css_styles_parent_mobile","field_css_styles_parent_tablet","field_css_styles_parent_desktop","field_shape_mobile","field_shape_tablet","field_shape_desktop","has_shape_outside","field_text_shape_outside_mobile","field_text_shape_outside_tablet","field_text_shape_outside_desktop","modalData","modalData_raw","field_render_mobile","field_render_tablet","field_render_desktop","this_options","JSON","parse","render","modal_shape","field_modal_shape","SyntaxError","textShapeOutside","Object","keys","length","left","left_mask","right","right_mask","childPaneFragment","childMarkdownRemark","htmlAst","children","value","field_options","buttons","field_image","this_image","this_imageData","filename","field_alt_text","alt_text","push","url","field_cdn_url","field_svg_file","localFile","publicURL","description","mode","device","width","z_index","parent","payload","hooksData","hooks","thisClass","field_background_colour","svgString","b64","window","btoa","dataUri","effects_payload","prefersReducedMotion","effects","controller","in","function","speed","delay","this_effects_css"],"sources":["src/compose-panes.js"],"sourcesContent":["import React, { useRef } from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport animateScrollTo from \"animated-scroll-to\";\nimport { IsVisible } from \"./is-visible.js\";\nimport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  InjectSvgShape,\n  InjectSvgModal,\n  StyledWrapperDiv,\n  InjectCssAnimation,\n  getCurrentPane,\n  thisViewportValue,\n} from \"./helpers\";\nimport { SvgPane, SvgModal } from \"./shapes\";\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.state?.viewport?.viewport?.key === \"undefined\") return <></>;\n  // is there a current pane to scroll to?\n  let visiblePane = getCurrentPane(\n    data?.state?.viewport?.currentPane,\n    data?.state?.viewport?.panes\n  );\n  if (visiblePane) {\n    let ref = document.getElementById(visiblePane);\n    if (ref) animateScrollTo(ref);\n  }\n\n  // loop through the panes in view and render each pane fragment\n  const composedPanes = data?.fragments?.relationships?.field_panes.map(\n    (pane, i) => {\n      let css = \"\",\n        imageMaskShapes = {},\n        textShapeOutsides = {};\n      // check for background colour\n      let background_colour = pane?.relationships?.field_pane_fragments.filter(\n        (e) => e?.internal?.type === \"paragraph__background_colour\"\n      );\n      // compose this pane\n      let this_selector, shape;\n      let pane_height = thisViewportValue(\n        data?.state?.viewport?.viewport?.key,\n        {\n          mobile: `calc((100vw - (var(--offset) * 1px)) * ${pane?.field_height_ratio_mobile} / 100)`,\n          tablet: `calc((100vw - (var(--offset) * 1px)) * ${pane?.field_height_ratio_tablet} / 100)`,\n          desktop: `calc((100vw - (var(--offset) * 1px)) * ${pane?.field_height_ratio_desktop} / 100)`,\n        }\n      );\n      let height_offset = thisViewportValue(\n        data?.state?.viewport?.viewport?.key,\n        {\n          mobile: `calc((100vw - (var(--offset) * 1px)) / 600 * ${pane?.field_height_offset_mobile})`,\n          tablet: `calc((100vw - (var(--offset) * 1px)) / 1080 * ${pane?.field_height_offset_tablet})`,\n          desktop: `calc((100vw - (var(--offset) * 1px)) / 1920 * ${pane?.field_height_offset_desktop})`,\n        }\n      );\n      // generate imageMaskShape(s)\n      imageMaskShapes = pane?.relationships?.field_pane_fragments\n        .map((e) => {\n          let imageMaskShapeSelector;\n          let this_pane = thisViewportValue(\n            data?.state?.viewport?.viewport?.key,\n            {\n              mobile: e?.field_image_mask_shape_mobile,\n              tablet: e?.field_image_mask_shape_tablet,\n              desktop: e?.field_image_mask_shape_desktop,\n            }\n          );\n          if (typeof this_pane === \"string\" && this_pane !== \"none\") {\n            shape = SvgPane(this_pane, data?.state?.viewport?.viewport?.key);\n            switch (e?.internal?.type) {\n              case \"paragraph__background_video\":\n                imageMaskShapeSelector = \".paneFragmentVideo\";\n                break;\n              case \"paragraph__background_image\":\n                imageMaskShapeSelector = \".paneFragmentImage\";\n                break;\n              case \"paragraph__svg\":\n                imageMaskShapeSelector = \".paneFragmentSvg\";\n                break;\n              case \"paragraph__markdown\":\n                imageMaskShapeSelector = \".paneFragmentParagraph\";\n                break;\n              default:\n                console.log(\n                  \"compose-panes.js > imageMaskShapes: miss on\",\n                  e?.internal?.type\n                );\n            }\n          }\n          if (typeof shape === \"undefined\") return null;\n          return {\n            selector: imageMaskShapeSelector,\n            shape: shape,\n            paneFragment: e?.id,\n          };\n        })\n        .filter(Boolean);\n\n      // now compose the paneFragments for this pane\n      let composedPaneFragments = pane?.relationships?.field_pane_fragments\n        // skip if current viewport is listed in field_hidden_viewports\n        .filter(\n          (e) =>\n            e.field_hidden_viewports\n              .replace(/\\s+/g, \"\")\n              .split(\",\")\n              .indexOf(data?.state?.viewport?.viewport?.key) == -1\n        )\n        // already processed background_colour\n        .filter((e) => e?.internal?.type !== \"paragraph__background_colour\")\n        // sort by zIndex ***important\n        .sort((a, b) => (a?.field_zindex > b?.field_zindex ? 1 : -1))\n        .map((pane_fragment, index) => {\n          let react_fragment,\n            tractStackFragment,\n            shape,\n            child,\n            action,\n            child_payload,\n            maskData,\n            buttonData,\n            videoData,\n            imageData = [],\n            css_child,\n            css_parent;\n\n          // select css for viewport\n          css_child = thisViewportValue(data?.state?.viewport?.viewport?.key, {\n            mobile: pane_fragment?.field_css_styles_mobile || \"\",\n            tablet: pane_fragment?.field_css_styles_tablet || \"\",\n            desktop: pane_fragment?.field_css_styles_desktop || \"\",\n          });\n          css_parent = thisViewportValue(data?.state?.viewport?.viewport?.key, {\n            mobile: pane_fragment?.field_css_styles_parent_mobile || \"\",\n            tablet: pane_fragment?.field_css_styles_parent_tablet || \"\",\n            desktop: pane_fragment?.field_css_styles_parent_desktop || \"\",\n          });\n          if (pane_fragment?.internal?.type === \"paragraph__background_pane\")\n            shape = thisViewportValue(data?.state?.viewport?.viewport?.key, {\n              mobile: pane_fragment?.field_shape_mobile,\n              tablet: pane_fragment?.field_shape_tablet,\n              desktop: pane_fragment?.field_shape_desktop,\n            });\n          let has_shape_outside = thisViewportValue(\n            data?.state?.viewport?.viewport?.key,\n            {\n              mobile: pane_fragment?.field_text_shape_outside_mobile,\n              tablet: pane_fragment?.field_text_shape_outside_tablet,\n              desktop: pane_fragment?.field_text_shape_outside_desktop,\n            }\n          );\n          // add modal if available\n          let modalData,\n            modalData_raw = thisViewportValue(\n              data?.state?.viewport?.viewport?.key,\n              {\n                mobile: pane_fragment?.field_render_mobile,\n                tablet: pane_fragment?.field_render_tablet,\n                desktop: pane_fragment?.field_render_desktop,\n              }\n            );\n          if (modalData_raw) {\n            let this_options;\n            try {\n              this_options = JSON.parse(modalData_raw);\n              if (typeof this_options?.render === \"object\")\n                modalData = this_options?.render;\n              modalData.modal_shape = SvgModal(\n                pane_fragment?.field_modal_shape,\n                data?.state?.viewport?.viewport?.key,\n                this_options\n              );\n            } catch (e) {\n              if (e instanceof SyntaxError) {\n                console.log(\"ERROR parsing json in {}: \", e);\n              }\n            }\n          }\n          // add shape outside if available\n          if (has_shape_outside && has_shape_outside !== \"none\") {\n            let textShapeOutside = SvgPane(\n              has_shape_outside,\n              data?.state?.viewport?.viewport?.key,\n              \"shape-outside\"\n            );\n            if (textShapeOutside)\n              maskData = {\n                textShapeOutside: textShapeOutside,\n              };\n            // store and inject into pane\n            textShapeOutsides[Object.keys(textShapeOutsides).length] = {\n              left: textShapeOutside?.left_mask,\n              right: textShapeOutside?.right_mask,\n            };\n          }\n          // prepare any markdown for this paneFragment\n          child_payload =\n            pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst;\n          if (child_payload) {\n            child_payload.children =\n              pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst?.children?.filter(\n                (e) => !(e.type === \"text\" && e.value === \"\\n\")\n              );\n          }\n          // prepare any buttonData\n          try {\n            action = JSON.parse(pane_fragment?.field_options);\n            if (typeof action?.buttons === \"object\")\n              buttonData = action?.buttons;\n          } catch (e) {\n            if (e instanceof SyntaxError) {\n              console.log(\"ERROR parsing json in {}: \", e);\n            }\n          }\n          // prepare any images from this paneFragment\n          pane_fragment?.relationships?.field_image?.map((e) => {\n            let this_image = thisViewportValue(\n              data?.state?.viewport?.viewport?.key,\n              {\n                mobile: e?.mobile,\n                tablet: e?.tablet,\n                desktop: e?.desktop,\n              }\n            );\n            if (this_image) {\n              let this_imageData = {\n                id: e?.id,\n                filename: e?.filename,\n                data: this_image,\n              };\n              if (typeof pane_fragment?.field_alt_text === \"string\")\n                this_imageData.alt_text = pane_fragment?.field_alt_text;\n              imageData.push(this_imageData);\n            }\n          });\n          // prepare any videos for this paneFragment\n          if (pane_fragment?.internal?.type === \"paragraph__background_video\") {\n            videoData = {\n              url: pane_fragment?.field_cdn_url,\n              alt_text: pane_fragment?.field_alt_text,\n            };\n          }\n          // prepare any svg for this paneFragment\n          if (pane_fragment?.internal?.type === \"paragraph__svg\") {\n            if (imageData.length)\n              console.log(\n                \"WARNING in compose-panes.js > imageData pre-exists?\"\n              );\n            imageData = [\n              {\n                url: pane_fragment?.relationships?.field_svg_file?.localFile\n                  ?.publicURL,\n                alt_text: pane_fragment?.field_svg_file?.description,\n              },\n            ];\n          }\n          // prepare structured data for this paneFragment\n          tractStackFragment = {\n            id: pane_fragment?.id,\n            mode: pane_fragment?.internal?.type,\n            viewport: {\n              device: data?.state?.viewport?.viewport?.key,\n              width: data?.state?.viewport?.viewport?.width,\n            },\n            z_index: pane_fragment?.field_zindex,\n            children: child_payload,\n            css: {\n              parent: css_parent,\n              child: css_child,\n            },\n            payload: {\n              imageData: imageData,\n              maskData: maskData,\n              modalData: modalData,\n              hooksData: data?.hooks,\n              videoData: videoData,\n            },\n          };\n\n          // all source data for this paneFragment\n          switch (tractStackFragment?.mode) {\n            case \"paragraph__markdown\":\n              react_fragment = MarkdownParagraph(tractStackFragment);\n              break;\n\n            case \"paragraph__background_pane\":\n              child = SvgPane(shape, data?.state?.viewport?.viewport?.key);\n              tractStackFragment.children = child;\n              react_fragment = InjectSvgShape(tractStackFragment);\n              break;\n\n            case \"paragraph__background_image\":\n              react_fragment = InjectGatsbyBackgroundImage(tractStackFragment);\n              break;\n\n            case \"paragraph__modal\":\n              react_fragment = InjectSvgModal(tractStackFragment);\n              break;\n\n            case \"paragraph__background_video\":\n              react_fragment = InjectGatsbyBackgroundVideo(tractStackFragment);\n              break;\n\n            case \"paragraph__svg\":\n              react_fragment = InjectSvg(tractStackFragment);\n              break;\n\n            case \"paragraph__d3\":\n              //\n              break;\n\n            case \"paragraph__h5p\":\n              //\n              break;\n\n            default:\n              console.log(\n                \"MISS on compose-panes.js:\",\n                tractStackFragment?.mode\n              );\n          }\n\n          let thisClass = `paneFragment paneFragment__view--${data?.state?.viewport?.viewport?.key}`;\n          return (\n            <div className={thisClass} key={pane_fragment?.id}>\n              <IsVisible\n                id={pane_fragment?.id}\n                className=\"paneFragment\"\n                key={pane_fragment?.id}\n              >\n                {react_fragment}\n              </IsVisible>\n            </div>\n          );\n        });\n\n      // skip if empty pane\n      if (Object.keys(composedPaneFragments).length === 0) return;\n      // prepare css for pane\n      css = `${css} height: ${pane_height}; margin-bottom: ${height_offset};`;\n      if (background_colour.length)\n        css = `${css} background-color: ${background_colour[0].field_background_colour};`;\n      // inject imageMaskShape(s) (if available)\n      if (Object.keys(imageMaskShapes).length)\n        imageMaskShapes.map((e) => {\n          if (typeof e?.shape === \"object\") {\n            let svgString = renderToStaticMarkup(e?.shape);\n            let b64 = window.btoa(svgString);\n            let dataUri = `data:image/svg+xml;base64,${b64}`;\n            css =\n              `${css} ${e?.selector} {-webkit-mask-image: url(\"${dataUri}\"); mask-image: url(\"${dataUri}\");` +\n              ` mask-repeat: no-repeat; -webkit-mask-size: 100% AUTO; mask-size: 100% AUTO; }`;\n          }\n        });\n      // inject textShapeOutside(s) (if available)\n      if (Object.keys(textShapeOutsides).length)\n        Object.keys(textShapeOutsides).map((i) => {\n          css = `${css} .paneFragmentParagraph { .svg-shape-outside-left {float:left;shape-outside:url(${textShapeOutsides[i]?.left})} .svg-shape-outside-right {float:right;shape-outside:url(${textShapeOutsides[i]?.right})} }`;\n        });\n      // may we wrap this in animation?\n      let effects_payload = {};\n      if (data?.state?.prefersReducedMotion?.prefersReducedMotion === false) {\n        let effects = data?.state?.controller?.payload?.effects;\n        let effects_payload;\n        for (const key in effects) {\n          if (effects[key]?.pane === pane?.id) {\n            effects_payload = {\n              in: [\n                effects[key]?.function,\n                effects[key]?.speed,\n                effects[key]?.delay,\n              ],\n            };\n            let this_effects_css = InjectCssAnimation(\n              effects_payload,\n              effects[key]?.paneFragment\n            );\n            css = css + this_effects_css;\n          }\n        }\n      }\n      return (\n        <section key={pane?.id}>\n          <IsVisible id={pane?.id} hooks={data?.hooks}>\n            <StyledWrapperDiv\n              className={`pane pane__view pane__view--${data?.state?.viewport?.viewport?.key}`}\n              css={css}\n            >\n              {composedPaneFragments}\n            </StyledWrapperDiv>\n          </IsVisible>\n        </section>\n      );\n    }\n  );\n\n  // this is the storyFragment\n  return composedPanes;\n}\n\nexport { ComposePanes };\n"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,MAAhB,QAA8B,OAA9B;AACA,SAASC,oBAAT,QAAqC,kBAArC;AACA,OAAOC,eAAP,MAA4B,oBAA5B;AACA,SAASC,SAAT,QAA0B,iBAA1B;AACA,SACEC,iBADF,EAEEC,2BAFF,EAGEC,2BAHF,EAIEC,SAJF,EAKEC,cALF,EAMEC,cANF,EAOEC,gBAPF,EAQEC,kBARF,EASEC,cATF,EAUEC,iBAVF,QAWO,WAXP;AAYA,SAASC,OAAT,EAAkBC,QAAlB,QAAkC,UAAlC;;AAEA,SAASC,YAAT,CAAsBC,IAAtB,EAA4B;EAC1B;EACA,IAAI,OAAOA,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAxC,KAAgD,WAApD,EAAiE,oBAAO,yCAAP,CAFvC,CAG1B;;EACA,IAAIC,WAAW,GAAGT,cAAc,CAC9BK,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBG,WADO,EAE9BL,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBI,KAFO,CAAhC;;EAIA,IAAIF,WAAJ,EAAiB;IACf,IAAIG,GAAG,GAAGC,QAAQ,CAACC,cAAT,CAAwBL,WAAxB,CAAV;IACA,IAAIG,GAAJ,EAAStB,eAAe,CAACsB,GAAD,CAAf;EACV,CAXyB,CAa1B;;;EACA,MAAMG,aAAa,GAAGV,IAAI,EAAEW,SAAN,EAAiBC,aAAjB,EAAgCC,WAAhC,CAA4CC,GAA5C,CACpB,CAACC,IAAD,EAAOC,CAAP,KAAa;IACX,IAAIC,GAAG,GAAG,EAAV;IAAA,IACEC,eAAe,GAAG,EADpB;IAAA,IAEEC,iBAAiB,GAAG,EAFtB,CADW,CAIX;;IACA,IAAIC,iBAAiB,GAAGL,IAAI,EAAEH,aAAN,EAAqBS,oBAArB,CAA0CC,MAA1C,CACrBC,CAAD,IAAOA,CAAC,EAAEC,QAAH,EAAaC,IAAb,KAAsB,8BADP,CAAxB,CALW,CAQX;;IACA,IAAIC,aAAJ,EAAmBC,KAAnB;IACA,IAAIC,WAAW,GAAGhC,iBAAiB,CACjCI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADA,EAEjC;MACE0B,MAAM,EAAG,0CAAyCd,IAAI,EAAEe,yBAA0B,SADpF;MAEEC,MAAM,EAAG,0CAAyChB,IAAI,EAAEiB,yBAA0B,SAFpF;MAGEC,OAAO,EAAG,0CAAyClB,IAAI,EAAEmB,0BAA2B;IAHtF,CAFiC,CAAnC;IAQA,IAAIC,aAAa,GAAGvC,iBAAiB,CACnCI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADE,EAEnC;MACE0B,MAAM,EAAG,gDAA+Cd,IAAI,EAAEqB,0BAA2B,GAD3F;MAEEL,MAAM,EAAG,iDAAgDhB,IAAI,EAAEsB,0BAA2B,GAF5F;MAGEJ,OAAO,EAAG,iDAAgDlB,IAAI,EAAEuB,2BAA4B;IAH9F,CAFmC,CAArC,CAlBW,CA0BX;;IACApB,eAAe,GAAGH,IAAI,EAAEH,aAAN,EAAqBS,oBAArB,CACfP,GADe,CACVS,CAAD,IAAO;MACV,IAAIgB,sBAAJ;MACA,IAAIC,SAAS,GAAG5C,iBAAiB,CAC/BI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADF,EAE/B;QACE0B,MAAM,EAAEN,CAAC,EAAEkB,6BADb;QAEEV,MAAM,EAAER,CAAC,EAAEmB,6BAFb;QAGET,OAAO,EAAEV,CAAC,EAAEoB;MAHd,CAF+B,CAAjC;;MAQA,IAAI,OAAOH,SAAP,KAAqB,QAArB,IAAiCA,SAAS,KAAK,MAAnD,EAA2D;QACzDb,KAAK,GAAG9B,OAAO,CAAC2C,SAAD,EAAYxC,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAA7C,CAAf;;QACA,QAAQoB,CAAC,EAAEC,QAAH,EAAaC,IAArB;UACE,KAAK,6BAAL;YACEc,sBAAsB,GAAG,oBAAzB;YACA;;UACF,KAAK,6BAAL;YACEA,sBAAsB,GAAG,oBAAzB;YACA;;UACF,KAAK,gBAAL;YACEA,sBAAsB,GAAG,kBAAzB;YACA;;UACF,KAAK,qBAAL;YACEA,sBAAsB,GAAG,wBAAzB;YACA;;UACF;YACEK,OAAO,CAACC,GAAR,CACE,6CADF,EAEEtB,CAAC,EAAEC,QAAH,EAAaC,IAFf;QAdJ;MAmBD;;MACD,IAAI,OAAOE,KAAP,KAAiB,WAArB,EAAkC,OAAO,IAAP;MAClC,OAAO;QACLmB,QAAQ,EAAEP,sBADL;QAELZ,KAAK,EAAEA,KAFF;QAGLoB,YAAY,EAAExB,CAAC,EAAEyB;MAHZ,CAAP;IAKD,CAvCe,EAwCf1B,MAxCe,CAwCR2B,OAxCQ,CAAlB,CA3BW,CAqEX;;IACA,IAAIC,qBAAqB,GAAGnC,IAAI,EAAEH,aAAN,EAAqBS,oBAArB,CAC1B;IAD0B,CAEzBC,MAFyB,CAGvBC,CAAD,IACEA,CAAC,CAAC4B,sBAAF,CACGC,OADH,CACW,MADX,EACmB,EADnB,EAEGC,KAFH,CAES,GAFT,EAGGC,OAHH,CAGWtD,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAH5C,KAGoD,CAAC,CAP/B,EAS1B;IAT0B,CAUzBmB,MAVyB,CAUjBC,CAAD,IAAOA,CAAC,EAAEC,QAAH,EAAaC,IAAb,KAAsB,8BAVX,EAW1B;IAX0B,CAYzB8B,IAZyB,CAYpB,CAACC,CAAD,EAAIC,CAAJ,KAAWD,CAAC,EAAEE,YAAH,GAAkBD,CAAC,EAAEC,YAArB,GAAoC,CAApC,GAAwC,CAAC,CAZhC,EAazB5C,GAbyB,CAarB,CAAC6C,aAAD,EAAgBC,KAAhB,KAA0B;MAC7B,IAAIC,cAAJ;MAAA,IACEC,kBADF;MAAA,IAEEnC,KAFF;MAAA,IAGEoC,KAHF;MAAA,IAIEC,MAJF;MAAA,IAKEC,aALF;MAAA,IAMEC,QANF;MAAA,IAOEC,UAPF;MAAA,IAQEC,SARF;MAAA,IASEC,SAAS,GAAG,EATd;MAAA,IAUEC,SAVF;MAAA,IAWEC,UAXF,CAD6B,CAc7B;;MACAD,SAAS,GAAG1E,iBAAiB,CAACI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAlC,EAAuC;QAClE0B,MAAM,EAAE8B,aAAa,EAAEa,uBAAf,IAA0C,EADgB;QAElEzC,MAAM,EAAE4B,aAAa,EAAEc,uBAAf,IAA0C,EAFgB;QAGlExC,OAAO,EAAE0B,aAAa,EAAEe,wBAAf,IAA2C;MAHc,CAAvC,CAA7B;MAKAH,UAAU,GAAG3E,iBAAiB,CAACI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAlC,EAAuC;QACnE0B,MAAM,EAAE8B,aAAa,EAAEgB,8BAAf,IAAiD,EADU;QAEnE5C,MAAM,EAAE4B,aAAa,EAAEiB,8BAAf,IAAiD,EAFU;QAGnE3C,OAAO,EAAE0B,aAAa,EAAEkB,+BAAf,IAAkD;MAHQ,CAAvC,CAA9B;MAKA,IAAIlB,aAAa,EAAEnC,QAAf,EAAyBC,IAAzB,KAAkC,4BAAtC,EACEE,KAAK,GAAG/B,iBAAiB,CAACI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAlC,EAAuC;QAC9D0B,MAAM,EAAE8B,aAAa,EAAEmB,kBADuC;QAE9D/C,MAAM,EAAE4B,aAAa,EAAEoB,kBAFuC;QAG9D9C,OAAO,EAAE0B,aAAa,EAAEqB;MAHsC,CAAvC,CAAzB;MAKF,IAAIC,iBAAiB,GAAGrF,iBAAiB,CACvCI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADM,EAEvC;QACE0B,MAAM,EAAE8B,aAAa,EAAEuB,+BADzB;QAEEnD,MAAM,EAAE4B,aAAa,EAAEwB,+BAFzB;QAGElD,OAAO,EAAE0B,aAAa,EAAEyB;MAH1B,CAFuC,CAAzC,CA/B6B,CAuC7B;;MACA,IAAIC,SAAJ;MAAA,IACEC,aAAa,GAAG1F,iBAAiB,CAC/BI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADF,EAE/B;QACE0B,MAAM,EAAE8B,aAAa,EAAE4B,mBADzB;QAEExD,MAAM,EAAE4B,aAAa,EAAE6B,mBAFzB;QAGEvD,OAAO,EAAE0B,aAAa,EAAE8B;MAH1B,CAF+B,CADnC;;MASA,IAAIH,aAAJ,EAAmB;QACjB,IAAII,YAAJ;;QACA,IAAI;UACFA,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAWN,aAAX,CAAf;UACA,IAAI,OAAOI,YAAY,EAAEG,MAArB,KAAgC,QAApC,EACER,SAAS,GAAGK,YAAY,EAAEG,MAA1B;UACFR,SAAS,CAACS,WAAV,GAAwBhG,QAAQ,CAC9B6D,aAAa,EAAEoC,iBADe,EAE9B/F,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAFH,EAG9BuF,YAH8B,CAAhC;QAKD,CATD,CASE,OAAOnE,CAAP,EAAU;UACV,IAAIA,CAAC,YAAYyE,WAAjB,EAA8B;YAC5BpD,OAAO,CAACC,GAAR,CAAY,4BAAZ,EAA0CtB,CAA1C;UACD;QACF;MACF,CAjE4B,CAkE7B;;;MACA,IAAI0D,iBAAiB,IAAIA,iBAAiB,KAAK,MAA/C,EAAuD;QACrD,IAAIgB,gBAAgB,GAAGpG,OAAO,CAC5BoF,iBAD4B,EAE5BjF,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAFL,EAG5B,eAH4B,CAA9B;QAKA,IAAI8F,gBAAJ,EACE/B,QAAQ,GAAG;UACT+B,gBAAgB,EAAEA;QADT,CAAX,CAPmD,CAUrD;;QACA9E,iBAAiB,CAAC+E,MAAM,CAACC,IAAP,CAAYhF,iBAAZ,EAA+BiF,MAAhC,CAAjB,GAA2D;UACzDC,IAAI,EAAEJ,gBAAgB,EAAEK,SADiC;UAEzDC,KAAK,EAAEN,gBAAgB,EAAEO;QAFgC,CAA3D;MAID,CAlF4B,CAmF7B;;;MACAvC,aAAa,GACXN,aAAa,EAAE8C,iBAAf,EAAkCC,mBAAlC,EAAuDC,OADzD;;MAEA,IAAI1C,aAAJ,EAAmB;QACjBA,aAAa,CAAC2C,QAAd,GACEjD,aAAa,EAAE8C,iBAAf,EAAkCC,mBAAlC,EAAuDC,OAAvD,EAAgEC,QAAhE,EAA0EtF,MAA1E,CACGC,CAAD,IAAO,EAAEA,CAAC,CAACE,IAAF,KAAW,MAAX,IAAqBF,CAAC,CAACsF,KAAF,KAAY,IAAnC,CADT,CADF;MAID,CA3F4B,CA4F7B;;;MACA,IAAI;QACF7C,MAAM,GAAG2B,IAAI,CAACC,KAAL,CAAWjC,aAAa,EAAEmD,aAA1B,CAAT;QACA,IAAI,OAAO9C,MAAM,EAAE+C,OAAf,KAA2B,QAA/B,EACE5C,UAAU,GAAGH,MAAM,EAAE+C,OAArB;MACH,CAJD,CAIE,OAAOxF,CAAP,EAAU;QACV,IAAIA,CAAC,YAAYyE,WAAjB,EAA8B;UAC5BpD,OAAO,CAACC,GAAR,CAAY,4BAAZ,EAA0CtB,CAA1C;QACD;MACF,CArG4B,CAsG7B;;;MACAoC,aAAa,EAAE/C,aAAf,EAA8BoG,WAA9B,EAA2ClG,GAA3C,CAAgDS,CAAD,IAAO;QACpD,IAAI0F,UAAU,GAAGrH,iBAAiB,CAChCI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADD,EAEhC;UACE0B,MAAM,EAAEN,CAAC,EAAEM,MADb;UAEEE,MAAM,EAAER,CAAC,EAAEQ,MAFb;UAGEE,OAAO,EAAEV,CAAC,EAAEU;QAHd,CAFgC,CAAlC;;QAQA,IAAIgF,UAAJ,EAAgB;UACd,IAAIC,cAAc,GAAG;YACnBlE,EAAE,EAAEzB,CAAC,EAAEyB,EADY;YAEnBmE,QAAQ,EAAE5F,CAAC,EAAE4F,QAFM;YAGnBnH,IAAI,EAAEiH;UAHa,CAArB;UAKA,IAAI,OAAOtD,aAAa,EAAEyD,cAAtB,KAAyC,QAA7C,EACEF,cAAc,CAACG,QAAf,GAA0B1D,aAAa,EAAEyD,cAAzC;UACF/C,SAAS,CAACiD,IAAV,CAAeJ,cAAf;QACD;MACF,CAnBD,EAvG6B,CA2H7B;;MACA,IAAIvD,aAAa,EAAEnC,QAAf,EAAyBC,IAAzB,KAAkC,6BAAtC,EAAqE;QACnE2C,SAAS,GAAG;UACVmD,GAAG,EAAE5D,aAAa,EAAE6D,aADV;UAEVH,QAAQ,EAAE1D,aAAa,EAAEyD;QAFf,CAAZ;MAID,CAjI4B,CAkI7B;;;MACA,IAAIzD,aAAa,EAAEnC,QAAf,EAAyBC,IAAzB,KAAkC,gBAAtC,EAAwD;QACtD,IAAI4C,SAAS,CAAC+B,MAAd,EACExD,OAAO,CAACC,GAAR,CACE,qDADF;QAGFwB,SAAS,GAAG,CACV;UACEkD,GAAG,EAAE5D,aAAa,EAAE/C,aAAf,EAA8B6G,cAA9B,EAA8CC,SAA9C,EACDC,SAFN;UAGEN,QAAQ,EAAE1D,aAAa,EAAE8D,cAAf,EAA+BG;QAH3C,CADU,CAAZ;MAOD,CA/I4B,CAgJ7B;;;MACA9D,kBAAkB,GAAG;QACnBd,EAAE,EAAEW,aAAa,EAAEX,EADA;QAEnB6E,IAAI,EAAElE,aAAa,EAAEnC,QAAf,EAAyBC,IAFZ;QAGnBvB,QAAQ,EAAE;UACR4H,MAAM,EAAE9H,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GADjC;UAER4H,KAAK,EAAE/H,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiC6H;QAFhC,CAHS;QAOnBC,OAAO,EAAErE,aAAa,EAAED,YAPL;QAQnBkD,QAAQ,EAAE3C,aARS;QASnBhD,GAAG,EAAE;UACHgH,MAAM,EAAE1D,UADL;UAEHR,KAAK,EAAEO;QAFJ,CATc;QAanB4D,OAAO,EAAE;UACP7D,SAAS,EAAEA,SADJ;UAEPH,QAAQ,EAAEA,QAFH;UAGPmB,SAAS,EAAEA,SAHJ;UAIP8C,SAAS,EAAEnI,IAAI,EAAEoI,KAJV;UAKPhE,SAAS,EAAEA;QALJ;MAbU,CAArB,CAjJ6B,CAuK7B;;MACA,QAAQN,kBAAkB,EAAE+D,IAA5B;QACE,KAAK,qBAAL;UACEhE,cAAc,GAAG1E,iBAAiB,CAAC2E,kBAAD,CAAlC;UACA;;QAEF,KAAK,4BAAL;UACEC,KAAK,GAAGlE,OAAO,CAAC8B,KAAD,EAAQ3B,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAzC,CAAf;UACA2D,kBAAkB,CAAC8C,QAAnB,GAA8B7C,KAA9B;UACAF,cAAc,GAAGtE,cAAc,CAACuE,kBAAD,CAA/B;UACA;;QAEF,KAAK,6BAAL;UACED,cAAc,GAAGzE,2BAA2B,CAAC0E,kBAAD,CAA5C;UACA;;QAEF,KAAK,kBAAL;UACED,cAAc,GAAGrE,cAAc,CAACsE,kBAAD,CAA/B;UACA;;QAEF,KAAK,6BAAL;UACED,cAAc,GAAGxE,2BAA2B,CAACyE,kBAAD,CAA5C;UACA;;QAEF,KAAK,gBAAL;UACED,cAAc,GAAGvE,SAAS,CAACwE,kBAAD,CAA1B;UACA;;QAEF,KAAK,eAAL;UACE;UACA;;QAEF,KAAK,gBAAL;UACE;UACA;;QAEF;UACElB,OAAO,CAACC,GAAR,CACE,2BADF,EAEEiB,kBAAkB,EAAE+D,IAFtB;MApCJ;;MA0CA,IAAIQ,SAAS,GAAI,oCAAmCrI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAI,EAAzF;MACA,oBACE;QAAK,SAAS,EAAEkI,SAAhB;QAA2B,GAAG,EAAE1E,aAAa,EAAEX;MAA/C,gBACE,oBAAC,SAAD;QACE,EAAE,EAAEW,aAAa,EAAEX,EADrB;QAEE,SAAS,EAAC,cAFZ;QAGE,GAAG,EAAEW,aAAa,EAAEX;MAHtB,GAKGa,cALH,CADF,CADF;IAWD,CA3OyB,CAA5B,CAtEW,CAmTX;;IACA,IAAIqC,MAAM,CAACC,IAAP,CAAYjD,qBAAZ,EAAmCkD,MAAnC,KAA8C,CAAlD,EAAqD,OApT1C,CAqTX;;IACAnF,GAAG,GAAI,GAAEA,GAAI,YAAWW,WAAY,oBAAmBO,aAAc,GAArE;IACA,IAAIf,iBAAiB,CAACgF,MAAtB,EACEnF,GAAG,GAAI,GAAEA,GAAI,sBAAqBG,iBAAiB,CAAC,CAAD,CAAjB,CAAqBkH,uBAAwB,GAA/E,CAxTS,CAyTX;;IACA,IAAIpC,MAAM,CAACC,IAAP,CAAYjF,eAAZ,EAA6BkF,MAAjC,EACElF,eAAe,CAACJ,GAAhB,CAAqBS,CAAD,IAAO;MACzB,IAAI,OAAOA,CAAC,EAAEI,KAAV,KAAoB,QAAxB,EAAkC;QAChC,IAAI4G,SAAS,GAAGvJ,oBAAoB,CAACuC,CAAC,EAAEI,KAAJ,CAApC;QACA,IAAI6G,GAAG,GAAGC,MAAM,CAACC,IAAP,CAAYH,SAAZ,CAAV;QACA,IAAII,OAAO,GAAI,6BAA4BH,GAAI,EAA/C;QACAvH,GAAG,GACA,GAAEA,GAAI,IAAGM,CAAC,EAAEuB,QAAS,8BAA6B6F,OAAQ,wBAAuBA,OAAQ,KAA1F,GACC,gFAFH;MAGD;IACF,CATD,EA3TS,CAqUX;;IACA,IAAIzC,MAAM,CAACC,IAAP,CAAYhF,iBAAZ,EAA+BiF,MAAnC,EACEF,MAAM,CAACC,IAAP,CAAYhF,iBAAZ,EAA+BL,GAA/B,CAAoCE,CAAD,IAAO;MACxCC,GAAG,GAAI,GAAEA,GAAI,mFAAkFE,iBAAiB,CAACH,CAAD,CAAjB,EAAsBqF,IAAK,8DAA6DlF,iBAAiB,CAACH,CAAD,CAAjB,EAAsBuF,KAAM,MAAnN;IACD,CAFD,EAvUS,CA0UX;;IACA,IAAIqC,eAAe,GAAG,EAAtB;;IACA,IAAI5I,IAAI,EAAEC,KAAN,EAAa4I,oBAAb,EAAmCA,oBAAnC,KAA4D,KAAhE,EAAuE;MACrE,IAAIC,OAAO,GAAG9I,IAAI,EAAEC,KAAN,EAAa8I,UAAb,EAAyBb,OAAzB,EAAkCY,OAAhD;MACA,IAAIF,eAAJ;;MACA,KAAK,MAAMzI,GAAX,IAAkB2I,OAAlB,EAA2B;QACzB,IAAIA,OAAO,CAAC3I,GAAD,CAAP,EAAcY,IAAd,KAAuBA,IAAI,EAAEiC,EAAjC,EAAqC;UACnC4F,eAAe,GAAG;YAChBI,EAAE,EAAE,CACFF,OAAO,CAAC3I,GAAD,CAAP,EAAc8I,QADZ,EAEFH,OAAO,CAAC3I,GAAD,CAAP,EAAc+I,KAFZ,EAGFJ,OAAO,CAAC3I,GAAD,CAAP,EAAcgJ,KAHZ;UADY,CAAlB;UAOA,IAAIC,gBAAgB,GAAG1J,kBAAkB,CACvCkJ,eADuC,EAEvCE,OAAO,CAAC3I,GAAD,CAAP,EAAc4C,YAFyB,CAAzC;UAIA9B,GAAG,GAAGA,GAAG,GAAGmI,gBAAZ;QACD;MACF;IACF;;IACD,oBACE;MAAS,GAAG,EAAErI,IAAI,EAAEiC;IAApB,gBACE,oBAAC,SAAD;MAAW,EAAE,EAAEjC,IAAI,EAAEiC,EAArB;MAAyB,KAAK,EAAEhD,IAAI,EAAEoI;IAAtC,gBACE,oBAAC,gBAAD;MACE,SAAS,EAAG,+BAA8BpI,IAAI,EAAEC,KAAN,EAAaC,QAAb,EAAuBA,QAAvB,EAAiCC,GAAI,EADjF;MAEE,GAAG,EAAEc;IAFP,GAIGiC,qBAJH,CADF,CADF,CADF;EAYD,CA7WmB,CAAtB,CAd0B,CA8X1B;;EACA,OAAOxC,aAAP;AACD;;AAED,SAASX,YAAT"}