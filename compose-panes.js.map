{"version":3,"sources":["src/compose-panes.js"],"names":["React","useRef","MarkdownParagraph","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","InjectSvgShape","StyledWrapperSection","IsVisible","SortStoryFragmentOrder","data","console","log","ComposePanes","viewport","key","composedPanes","fragments","relationships","field_panes","map","pane","i","background_colour","field_pane_fragments","filter","e","field_hidden_viewports","replace","split","indexOf","internal","type","composedPane","sort","a","b","pane_fragment","index","react_fragment","alt_text","imageData","shape","css_styles","css_styles_parent","field_css_styles_mobile","field_css_styles_parent_mobile","field_shape_mobile","field_css_styles_tablet","field_css_styles_parent_tablet","field_shape_tablet","field_css_styles_desktop","field_css_styles_parent_desktop","field_shape_desktop","child","childPaneFragment","childMarkdownRemark","htmlAst","children","value","id","field_image","field_zindex","field_cdn_url","field_alt_text","field_svg_file","localFile","publicURL","description","prefersReducedMotion","options","JSON","parse","field_options","effects","effects_payload","in","onscreen","function","speed","delay","out","offscreen","pane_height","field_height_ratio_mobile","field_height_ratio_tablet","field_height_ratio_desktop","Object","keys","length","this_css","parseInt","field_background_colour"],"mappings":"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","sourcesContent":["import React, { useRef } from \"react\";\nimport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  InjectSvgShape,\n  StyledWrapperSection,\n} from \"./helpers\";\nimport { IsVisible } from \"./is-visible.js\";\n\nconst SortStoryFragmentOrder = (data) => {\n  switch (data) {\n    // return weight ... lowest is first\n    case \"paragraph__background_image\":\n    case \"paragraph__background_video\":\n    case \"paragraph__svg\":\n      return 0;\n\n    case \"paragraph__background_pane\":\n      return 1;\n\n    case \"paragraph__markdown\":\n      return 10;\n\n    default:\n      console.log(\"MISS in compose-panes.js SortStoryFragmentOrder:\", data);\n      return 1;\n  }\n};\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.viewport?.key === \"undefined\") return <></>;\n  // loop through the panes in view and render each pane fragment\n  const composedPanes = data?.fragments?.relationships?.field_panes.map(\n    (pane, i) => {\n      // check for background colour\n      let background_colour = pane?.relationships?.field_pane_fragments\n        // skip if current viewport is listed in field_hidden_viewports\n        .filter(\n          (e) =>\n            e.field_hidden_viewports\n              .replace(/\\s+/g, \"\")\n              .split(\",\")\n              .indexOf(data?.viewport?.key) == -1\n        )\n        .filter((e) => e?.internal?.type === \"paragraph__background_colour\");\n\n      let composedPane = pane?.relationships?.field_pane_fragments\n        // skip if current viewport is listed in field_hidden_viewports\n        .filter(\n          (e) =>\n            e.field_hidden_viewports\n              .replace(/\\s+/g, \"\")\n              .split(\",\")\n              .indexOf(data?.viewport?.key) == -1\n        )\n        // already processed background_colour\n        .filter((e) => e?.internal?.type !== \"paragraph__background_colour\")\n        // sort\n        .sort((a, b) =>\n          SortStoryFragmentOrder(a?.internal?.type) >\n          SortStoryFragmentOrder(b?.internal?.type)\n            ? 1\n            : -1\n        )\n        .map((pane_fragment, index) => {\n          let react_fragment,\n            alt_text,\n            imageData,\n            shape = \"\",\n            css_styles = \"\",\n            css_styles_parent = \"\";\n\n          // select css for viewport\n          switch (data?.viewport?.key) {\n            case \"mobile\":\n              css_styles = pane_fragment?.field_css_styles_mobile;\n              css_styles_parent = pane_fragment?.field_css_styles_parent_mobile;\n              if (\n                pane_fragment?.internal?.type === \"paragraph__background_pane\"\n              )\n                shape = pane_fragment?.field_shape_mobile;\n              break;\n            case \"tablet\":\n              css_styles = pane_fragment?.field_css_styles_tablet;\n              css_styles_parent = pane_fragment?.field_css_styles_parent_tablet;\n              if (\n                pane_fragment?.internal?.type === \"paragraph__background_pane\"\n              )\n                shape = pane_fragment?.field_shape_tablet;\n              break;\n            case \"desktop\":\n              css_styles = pane_fragment?.field_css_styles_desktop;\n              css_styles_parent =\n                pane_fragment?.field_css_styles_parent_desktop;\n              if (\n                pane_fragment?.internal?.type === \"paragraph__background_pane\"\n              )\n                shape = pane_fragment?.field_shape_desktop;\n              break;\n          }\n\n          // render this paneFragment\n          switch (pane_fragment?.internal?.type) {\n            case \"paragraph__markdown\":\n              // now pre-render MarkdownParagraph elements and inject images\n              let child =\n                pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst;\n              child.children =\n                pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst?.children?.filter(\n                  (e) => !(e.type === \"text\" && e.value === \"\\n\")\n                );\n              react_fragment = MarkdownParagraph(\n                pane_fragment?.id,\n                child,\n                pane_fragment?.relationships?.field_image,\n                css_styles_parent,\n                css_styles,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__background_pane\":\n              react_fragment = InjectSvgShape(\n                pane_fragment?.id,\n                shape,\n                data?.viewport?.key,\n                css_styles_parent,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__background_video\":\n              react_fragment = InjectGatsbyBackgroundVideo(\n                pane_fragment?.id,\n                pane_fragment?.field_cdn_url,\n                pane_fragment?.field_alt_text,\n                css_styles_parent,\n                css_styles,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__background_image\":\n              react_fragment = InjectGatsbyBackgroundImage(\n                pane_fragment?.id,\n                pane_fragment?.relationships?.field_image[0] &&\n                  pane_fragment?.relationships?.field_image[0][\n                    data?.viewport?.key\n                  ],\n                pane_fragment?.field_alt_text,\n                css_styles_parent,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__svg\":\n              react_fragment = InjectSvg(\n                pane_fragment?.id,\n                pane_fragment?.relationships?.field_svg_file?.localFile\n                  ?.publicURL,\n                pane_fragment?.field_svg_file?.description,\n                css_styles_parent,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__d3\":\n              //\n              break;\n\n            case \"paragraph__h5p\":\n              //\n              break;\n          }\n\n          // can we wrap this in animation?\n          if (data?.prefersReducedMotion === false) {\n            // check for options payload\n            const options = JSON.parse(pane_fragment?.field_options);\n            let effects = options?.effects;\n            if (effects && !\"onscreen\" in effects && !\"offscreen\" in effects) {\n              // if no options, do not animate\n              <div key={pane_fragment?.id}>{react_fragment}</div>;\n            }\n            // else animate\n            let effects_payload = {\n              in: [\n                effects?.onscreen?.function,\n                effects?.onscreen?.speed,\n                effects?.onscreen?.delay,\n              ],\n              out: [\n                effects?.offscreen?.function,\n                effects?.offscreen?.speed,\n                effects?.offscreen?.delay,\n              ],\n            };\n            react_fragment = (\n              <IsVisible effects={effects_payload}>{react_fragment}</IsVisible>\n            );\n          }\n          return (\n            <div className=\"paneFragment\" key={pane_fragment?.id}>\n              {react_fragment}\n            </div>\n          );\n        });\n\n      // compose this pane\n      let pane_height;\n      switch (data?.viewport?.key) {\n        case \"mobile\":\n          pane_height = pane?.field_height_ratio_mobile;\n          break;\n        case \"tablet\":\n          pane_height = pane?.field_height_ratio_tablet;\n          break;\n        case \"desktop\":\n          pane_height = pane?.field_height_ratio_desktop;\n          break;\n      }\n      // skip if empty pane\n      if (Object.keys(composedPane).length === 0) return;\n      let this_css = \"height:\" + parseInt(pane_height) + \"vw;\";\n      if (background_colour.length)\n        this_css =\n          this_css +\n          \" background-color:\" +\n          background_colour[0].field_background_colour +\n          \";\";\n      return (\n        <StyledWrapperSection\n          key={pane?.id}\n          className={\"pane pane__view--\" + data?.viewport?.key}\n          css={this_css}\n        >\n          {composedPane}\n        </StyledWrapperSection>\n      );\n    }\n  );\n  // this is the storyFragment\n  return composedPanes;\n}\n\nexport { ComposePanes };\n"],"file":"compose-panes.js"}