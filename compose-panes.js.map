{"version":3,"file":"compose-panes.js","names":["React","useRef","renderToStaticMarkup","animateScrollTo","IsVisible","MarkdownParagraph","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","InjectSvgShape","InjectSvgModal","StyledWrapperDiv","InjectCssAnimation","getCurrentPane","thisViewportValue","SvgPane","SvgModal","SvgModals","SvgShape","ComposePanes","data","state","viewport","key","visiblePane","currentPane","panes","ref","document","getElementById","composedPanes","fragments","relationships","field_panes","map","pane","i","pane_css","pane_effects","css","textShapeOutside","modals","effects","background_colour","field_pane_fragments","filter","e","internal","type","this_selector","shape","pane_height_ratio","mobile","field_height_ratio_mobile","tablet","field_height_ratio_tablet","desktop","field_height_ratio_desktop","pane_height","pane_height_css","height_offset","field_height_offset_mobile","field_height_offset_tablet","field_height_offset_desktop","composedPaneFragments","field_hidden_viewports","replace","split","indexOf","sort","a","b","field_zindex","pane_fragment","index","react_fragment","tractStackFragment","payload","tempValue","imageData","field_text_shape_outside_mobile","field_text_shape_outside_tablet","field_text_shape_outside_desktop","field_modal","this_options","console","log","maskData","id","left_mask","right_mask","field_options","this_payload","this_fragment","this_shape","this_css","this_viewport","JSON","parse","render","device","width","cut","height","z_index","modal_shape","field_css_styles_parent_mobile","field_css_styles_parent_tablet","field_css_styles_parent_desktop","Object","keys","length","fragment","parent","modalData","SyntaxError","field_shape_mobile","field_shape_tablet","field_shape_desktop","shapeData","videoData","url","field_cdn_url","alt_text","field_alt_text","field_svg_file","localFile","publicURL","description","childPaneFragment","childMarkdownRemark","htmlAst","children","value","action","buttons","buttonData","structuredClone","field_image","this_image","this_imageData","filename","push","css_child","field_css_styles_mobile","field_css_styles_tablet","field_css_styles_desktop","css_parent","mode","child","hooksData","hooks","this_modal","thisClass","field_background_colour","imageMaskShapes","imageMaskShapeSelector","this_pane","field_image_mask_shape_mobile","field_image_mask_shape_tablet","field_image_mask_shape_desktop","selector","paneFragment","Boolean","svgString","b64","window","btoa","dataUri","entries","forEach","padding_left","padding_top","prefersReducedMotion","this_effects_payload","in","function","speed","delay","this_effects_css"],"sources":["src/compose-panes.js"],"sourcesContent":["import React, { useRef } from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport animateScrollTo from \"animated-scroll-to\";\nimport { IsVisible } from \"./is-visible.js\";\nimport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  InjectSvgShape,\n  InjectSvgModal,\n  StyledWrapperDiv,\n  InjectCssAnimation,\n  getCurrentPane,\n  thisViewportValue,\n} from \"./helpers\";\nimport { SvgPane, SvgModal, SvgModals, SvgShape } from \"./shapes\";\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.state?.viewport?.viewport?.key === \"undefined\") return <></>;\n\n  // is there a current pane to scroll to?\n  let visiblePane = getCurrentPane(\n    data?.state?.viewport?.currentPane,\n    data?.state?.viewport?.panes\n  );\n  if (visiblePane) {\n    let ref = document.getElementById(visiblePane);\n    if (ref) animateScrollTo(ref);\n  }\n\n  // loop through the panes in view and render each pane fragment\n  const composedPanes = data?.fragments?.relationships?.field_panes.map(\n    (pane, i) => {\n      let pane_css = \"\",\n        pane_effects = [],\n        css = \"\",\n        textShapeOutside = {},\n        modals = {},\n        effects = [];\n\n      // set key variables\n      let background_colour = pane?.relationships?.field_pane_fragments.filter(\n        (e) => e?.internal?.type === \"paragraph__background_colour\"\n      );\n      let this_selector, shape;\n      let pane_height_ratio = thisViewportValue(\n        data?.state?.viewport?.viewport?.key,\n        {\n          mobile: pane?.field_height_ratio_mobile,\n          tablet: pane?.field_height_ratio_tablet,\n          desktop: pane?.field_height_ratio_desktop,\n        }\n      );\n      let pane_height = thisViewportValue(\n        data?.state?.viewport?.viewport?.key,\n        {\n          mobile: (600 * pane_height_ratio) / 100,\n          tablet: (1080 * pane_height_ratio) / 100,\n          desktop: (1920 * pane_height_ratio) / 100,\n        }\n      );\n      let pane_height_css = `calc((100vw - (var(--offset) * 1px)) * ${pane_height_ratio} / 100)`;\n      let height_offset = thisViewportValue(\n        data?.state?.viewport?.viewport?.key,\n        {\n          mobile: `calc((100vw - (var(--offset) * 1px)) / 600 * ${pane?.field_height_offset_mobile})`,\n          tablet: `calc((100vw - (var(--offset) * 1px)) / 1080 * ${pane?.field_height_offset_tablet})`,\n          desktop: `calc((100vw - (var(--offset) * 1px)) / 1920 * ${pane?.field_height_offset_desktop})`,\n        }\n      );\n\n      // now compose the paneFragments for this pane\n      let composedPaneFragments = [];\n      pane?.relationships?.field_pane_fragments\n        // skip if current viewport is listed in field_hidden_viewports\n        .filter(\n          (e) =>\n            typeof e?.field_hidden_viewports === \"string\" &&\n            e?.field_hidden_viewports\n              .replace(/\\s+/g, \"\")\n              .split(\",\")\n              .indexOf(data?.state?.viewport?.viewport?.key) == -1\n        )\n        // already processed background_colour\n        .filter((e) => e?.internal?.type !== \"paragraph__background_colour\")\n        // sort by zIndex ***important\n        .sort((a, b) => (a?.field_zindex > b?.field_zindex ? 1 : -1))\n        .map((pane_fragment, index) => {\n          let react_fragment,\n            tractStackFragment,\n            payload = {},\n            tempValue,\n            shape;\n          payload.imageData = [];\n\n          // pre-pass paneFragment based on type\n          switch (pane_fragment?.internal?.type) {\n            case \"paragraph__markdown\":\n              shape = thisViewportValue(data?.state?.viewport?.viewport?.key, {\n                mobile: pane_fragment?.field_text_shape_outside_mobile,\n                tablet: pane_fragment?.field_text_shape_outside_tablet,\n                desktop: pane_fragment?.field_text_shape_outside_desktop,\n              });\n              if (shape && !pane_fragment?.field_modal) {\n                // regular markdown paragraph; add shape outside if any\n                if (shape && shape !== \"none\") {\n                  let this_options = {\n                    textShapeOutside: true,\n                    viewport: data?.state?.viewport?.viewport,\n                    pane_height: pane_height,\n                  };\n                  let tempValue;\n                  tempValue = SvgPane(\n                    shape,\n                    data?.state?.viewport?.viewport?.key,\n                    \"shape-outside\"\n                  );\n                  console.log(2, tempValue);\n                  tempValue = SvgShape(shape, this_options);\n                  console.log(1, tempValue);\n                  if (tempValue)\n                    payload.maskData = {\n                      textShapeOutside: tempValue,\n                    };\n                  // store shapeOutside to inject into pane\n                  textShapeOutside[pane_fragment?.id] = {\n                    id: tempValue?.id,\n                    left_mask: tempValue?.left_mask,\n                    right_mask: tempValue?.right_mask,\n                  };\n                }\n              } else if (shape && pane_fragment?.field_modal) {\n                // this is a modal\n                if (typeof pane_fragment?.field_options === \"string\") {\n                  let this_options,\n                    this_payload,\n                    this_fragment,\n                    this_shape,\n                    this_css,\n                    this_viewport;\n                  try {\n                    this_options = JSON.parse(pane_fragment?.field_options);\n                    if (typeof this_options?.render === \"object\") {\n                      this_payload =\n                        this_options?.render[\n                          data?.state?.viewport?.viewport?.key\n                        ];\n                      this_payload.id = pane_fragment?.id;\n                      this_viewport = {\n                        device: data?.state?.viewport?.viewport?.key,\n                        width: data?.state?.viewport?.viewport?.width,\n                      };\n                      this_payload.viewport = this_viewport;\n                      this_payload.cut = SvgModals[shape][\"cut\"];\n                      this_payload.width = SvgModals[shape][\"viewBox\"][0];\n                      this_payload.height = SvgModals[shape][\"viewBox\"][1];\n                      this_payload.pane_height = pane_height;\n                      this_payload.z_index = pane_fragment?.field_zindex;\n                      this_shape = SvgModal(shape, this_payload);\n                      // generate react fragment\n                      this_fragment = InjectSvgModal(\n                        this_shape?.modal_shape,\n                        this_payload\n                      );\n                      this_payload.shape = this_shape;\n                      this_css = thisViewportValue(\n                        data?.state?.viewport?.viewport?.key,\n                        {\n                          mobile: pane_fragment?.field_css_styles_parent_mobile,\n                          tablet: pane_fragment?.field_css_styles_parent_tablet,\n                          desktop:\n                            pane_fragment?.field_css_styles_parent_desktop,\n                        }\n                      );\n                      // add modal to inject in pane later\n                      modals[Object.keys(modals).length] = {\n                        id: pane_fragment?.id,\n                        fragment: this_fragment,\n                        z_index: pane_fragment?.field_zindex,\n                        css: {\n                          parent: this_css,\n                        },\n                        payload: {\n                          modalData: this_payload,\n                        },\n                      };\n                    }\n                    // store shapeOutside to inject into pane\n                    textShapeOutside[pane_fragment?.id] = {\n                      id: this_shape?.id,\n                      left_mask: this_shape?.left_mask,\n                      right_mask: this_shape?.right_mask,\n                    };\n                    payload.maskData = { textShapeOutside: this_shape };\n                  } catch (e) {\n                    if (e instanceof SyntaxError) {\n                      console.log(\"ERROR parsing json in {}: \", e);\n                    }\n                  }\n                }\n              }\n              break;\n\n            case \"paragraph__background_pane\":\n              shape = thisViewportValue(data?.state?.viewport?.viewport?.key, {\n                mobile: pane_fragment?.field_shape_mobile,\n                tablet: pane_fragment?.field_shape_tablet,\n                desktop: pane_fragment?.field_shape_desktop,\n              });\n              tempValue = SvgPane(shape, data?.state?.viewport?.viewport?.key);\n              if (tempValue) payload.shapeData = tempValue;\n              break;\n\n            case \"paragraph__background_video\":\n              payload.videoData = {\n                url: pane_fragment?.field_cdn_url,\n                alt_text: pane_fragment?.field_alt_text,\n              };\n              break;\n\n            case \"paragraph__svg\":\n              payload.imageData = [\n                {\n                  url: pane_fragment?.relationships?.field_svg_file?.localFile\n                    ?.publicURL,\n                  alt_text: pane_fragment?.field_svg_file?.description,\n                },\n              ];\n              break;\n          }\n\n          // prepare any markdown for this paneFragment\n          if (pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst) {\n            payload.children =\n              pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst;\n            payload.children.children =\n              pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst?.children?.filter(\n                (e) => !(e.type === \"text\" && e.value === \"\\n\")\n              );\n          }\n          // extract animation effects and buttonData (if any)\n          if (typeof pane_fragment?.field_options === \"string\") {\n            let action;\n            try {\n              action = JSON.parse(pane_fragment?.field_options);\n              if (typeof tempValue?.buttons === \"object\")\n                payload.buttonData = tempValue?.buttons;\n              // effects are directly injected into each pane below\n              if (typeof action?.effects === \"object\") {\n                for (const key in action?.effects) {\n                  // store animation\n                  effects[`fragment-${pane_fragment?.id}`] =\n                    action?.effects[key];\n                  effects[`fragment-${pane_fragment?.id}`][\n                    \"paneFragment\"\n                  ] = `fragment-${pane_fragment?.id}`;\n                  effects[`fragment-${pane_fragment?.id}`][\"pane\"] = pane?.id;\n                  // clone and store animation for modal (if any)\n                  if (\n                    pane_fragment?.internal?.type === \"paragraph__modal\" ||\n                    pane_fragment?.field_modal\n                  ) {\n                    effects[`modal-${pane_fragment?.id}`] = structuredClone(\n                      action?.effects[key]\n                    );\n                    effects[`modal-${pane_fragment?.id}`][\n                      \"paneFragment\"\n                    ] = `modal-${pane_fragment?.id}`;\n                  }\n                }\n              }\n            } catch (e) {\n              if (e instanceof SyntaxError) {\n                console.log(\"ERROR parsing json in compose-panes.js: \", e);\n              }\n            }\n          }\n          // prepare any images from this paneFragment\n          pane_fragment?.relationships?.field_image?.map((e) => {\n            let this_image = thisViewportValue(\n              data?.state?.viewport?.viewport?.key,\n              {\n                mobile: e?.mobile,\n                tablet: e?.tablet,\n                desktop: e?.desktop,\n              }\n            );\n            if (this_image) {\n              let this_imageData = {\n                id: e?.id,\n                filename: e?.filename,\n                data: this_image,\n              };\n              if (typeof pane_fragment?.field_alt_text === \"string\")\n                this_imageData.alt_text = pane_fragment?.field_alt_text;\n              payload.imageData.push(this_imageData);\n            }\n          });\n          // select css for viewport\n          payload.css_child = thisViewportValue(\n            data?.state?.viewport?.viewport?.key,\n            {\n              mobile: pane_fragment?.field_css_styles_mobile || \"\",\n              tablet: pane_fragment?.field_css_styles_tablet || \"\",\n              desktop: pane_fragment?.field_css_styles_desktop || \"\",\n            }\n          );\n          payload.css_parent = thisViewportValue(\n            data?.state?.viewport?.viewport?.key,\n            {\n              mobile: pane_fragment?.field_css_styles_parent_mobile || \"\",\n              tablet: pane_fragment?.field_css_styles_parent_tablet || \"\",\n              desktop: pane_fragment?.field_css_styles_parent_desktop || \"\",\n            }\n          );\n\n          // prepare structured data for this paneFragment\n          tractStackFragment = {\n            id: pane_fragment?.id,\n            mode: pane_fragment?.internal?.type,\n            viewport: {\n              device: data?.state?.viewport?.viewport?.key,\n              width: data?.state?.viewport?.viewport?.width,\n            },\n            z_index: pane_fragment?.field_zindex,\n            children: payload?.children || {},\n            css: {\n              parent: payload?.css_parent || \"\",\n              child: payload?.css_child || \"\",\n            },\n            payload: {\n              imageData: payload?.imageData || [],\n              maskData: payload?.maskData || {},\n              hooksData: data?.hooks || {},\n              videoData: payload?.videoData || {},\n              shapeData: payload?.shapeData || {},\n              modalData: payload?.modalData || {},\n            },\n          };\n\n          // generate react for this paneFragment\n          switch (tractStackFragment?.mode) {\n            case \"paragraph__markdown\":\n              react_fragment = MarkdownParagraph(tractStackFragment);\n              break;\n\n            case \"paragraph__background_pane\":\n              react_fragment = InjectSvgShape(tractStackFragment);\n              break;\n\n            case \"paragraph__background_image\":\n              react_fragment = InjectGatsbyBackgroundImage(tractStackFragment);\n              break;\n\n            case \"paragraph__background_video\":\n              react_fragment = InjectGatsbyBackgroundVideo(tractStackFragment);\n              break;\n\n            case \"paragraph__svg\":\n              react_fragment = InjectSvg(tractStackFragment);\n              break;\n\n            case \"paragraph__d3\":\n              //\n              break;\n\n            case \"paragraph__h5p\":\n              //\n              break;\n\n            default:\n              console.log(\n                \"MISS on compose-panes.js:\",\n                tractStackFragment?.mode\n              );\n          }\n\n          // inject modal(s) if any\n          if (Object.keys(modals).length)\n            Object.keys(modals)\n              .filter((i) => modals[i]?.id === pane_fragment?.id)\n              .map((i) => {\n                let this_modal = modals[i];\n                // add this modal to composedPaneFragments\n                composedPaneFragments.push(\n                  <div\n                    className={`paneFragment paneFragment__view paneFragment__view--${data?.state?.viewport?.viewport?.key}`}\n                    key={`modal-${this_modal?.id}`}\n                  >\n                    <IsVisible\n                      id={`modal-${this_modal?.id}`}\n                      className=\"paneFragment\"\n                      key={`${this_modal?.id}-visible`}\n                    >\n                      {this_modal?.fragment}\n                    </IsVisible>\n                  </div>\n                );\n              });\n          // add the composed pane fragment\n          let thisClass = `paneFragment paneFragment__view paneFragment__view--${data?.state?.viewport?.viewport?.key}`;\n          composedPaneFragments.push(\n            <div className={thisClass} key={pane_fragment?.id}>\n              <IsVisible\n                id={`fragment-${pane_fragment?.id}`}\n                className=\"paneFragment\"\n                key={pane_fragment?.id}\n              >\n                {react_fragment}\n              </IsVisible>\n            </div>\n          );\n        });\n      // skip if empty pane\n      if (composedPaneFragments.length === 0) return;\n\n      // now render the pane\n      // prepare css for pane\n      css = `${css} height: ${pane_height_css}; margin-bottom: ${height_offset};`;\n      if (background_colour.length)\n        css = `${css} background-color: ${background_colour[0].field_background_colour};`;\n\n      // inject imageMaskShape(s) (if any)\n      let imageMaskShapes = pane?.relationships?.field_pane_fragments\n        .map((e) => {\n          let imageMaskShapeSelector;\n          let this_pane = thisViewportValue(\n            data?.state?.viewport?.viewport?.key,\n            {\n              mobile: e?.field_image_mask_shape_mobile,\n              tablet: e?.field_image_mask_shape_tablet,\n              desktop: e?.field_image_mask_shape_desktop,\n            }\n          );\n          if (typeof this_pane === \"string\" && this_pane !== \"none\") {\n            shape = SvgPane(this_pane, data?.state?.viewport?.viewport?.key);\n            switch (e?.internal?.type) {\n              case \"paragraph__background_video\":\n                imageMaskShapeSelector = \".paneFragmentVideo\";\n                break;\n              case \"paragraph__background_image\":\n                imageMaskShapeSelector = \".paneFragmentImage\";\n                break;\n              case \"paragraph__svg\":\n                imageMaskShapeSelector = \".paneFragmentSvg\";\n                break;\n              case \"paragraph__markdown\":\n                imageMaskShapeSelector = \".paneFragmentParagraph\";\n                break;\n              default:\n                console.log(\n                  \"compose-panes.js > imageMaskShapes: miss on\",\n                  e?.internal?.type\n                );\n            }\n          }\n          if (typeof shape === \"undefined\") return null;\n          return {\n            selector: imageMaskShapeSelector,\n            shape: shape,\n            paneFragment: e?.id,\n          };\n        })\n        .filter(Boolean);\n      if (Object.keys(imageMaskShapes).length)\n        imageMaskShapes.map((e) => {\n          if (typeof e?.shape === \"object\") {\n            let svgString = renderToStaticMarkup(e?.shape);\n            let b64 = window.btoa(svgString);\n            let dataUri = `data:image/svg+xml;base64,${b64}`;\n            css =\n              `${css} ${e?.selector} {-webkit-mask-image: url(\"${dataUri}\"); mask-image: url(\"${dataUri}\");` +\n              ` mask-repeat: no-repeat; -webkit-mask-size: 100% AUTO; mask-size: 100% AUTO; }`;\n          }\n        });\n\n      // inject textShapeOutside(s) (if any)\n      Object.entries(textShapeOutside).forEach(([key, value]) => {\n        css =\n          `${css} #svg__${value?.id}--shape-outside-left {float:left;shape-outside:url(${value?.left_mask})} ` +\n          `#svg__${value?.id}--shape-outside-right {float:right;shape-outside:url(${value?.right_mask})}`;\n      });\n      // add this css for modal (if any)\n      if (Object.keys(modals).length)\n        Object.keys(modals).map((i) => {\n          let this_modal = modals[i];\n          css =\n            `${css} ${this_modal?.css?.parent} ` +\n            `#fragment-${this_modal?.id} svg.svg-shape-outside-left { ` +\n            `z-index: ${this_modal?.z_index - 1};` +\n            `width: calc((100vw - (var(--offset) * 1px)) / ${\n              this_modal?.payload?.modalData?.viewport?.width\n            } * ${\n              this_modal?.payload?.modalData?.padding_left +\n              this_modal?.payload?.modalData?.cut\n            }); ` +\n            `} ` +\n            `#fragment-${this_modal?.id} svg.svg-shape-outside-right { ` +\n            `z-index: ${this_modal?.z_index - 1};` +\n            `width: calc((100vw - (var(--offset) * 1px)) / ${\n              this_modal?.payload?.modalData?.viewport?.width\n            } * ${\n              this_modal?.payload?.modalData?.viewport?.width -\n              this_modal?.payload?.modalData?.width +\n              this_modal?.payload?.modalData?.cut -\n              this_modal?.payload?.modalData?.padding_left\n            }); ` +\n            `} ` +\n            `#${this_modal?.id}-svg-modal svg { ` +\n            `z-index: ${this_modal?.z_index - 1}; ` +\n            `width: calc((100vw - (var(--offset) * 1px)) / ${this_modal?.payload?.modalData?.viewport?.width} * ${this_modal?.payload?.modalData?.width}); ` +\n            `margin-left: calc((100vw - (var(--offset) * 1px)) / ${this_modal?.payload?.modalData?.viewport?.width} * ${this_modal?.payload?.modalData?.padding_left}); ` +\n            `margin-top: calc((100vw - (var(--offset) * 1px)) / ${this_modal?.payload?.modalData?.viewport?.width} * ${this_modal?.payload?.modalData?.padding_top}); ` +\n            `}`;\n        });\n\n      // may we wrap this in animation?\n      if (data?.state?.prefersReducedMotion?.prefersReducedMotion === false) {\n        for (const key in effects) {\n          let this_effects_payload = {\n            in: [\n              effects[key]?.function,\n              effects[key]?.speed,\n              effects[key]?.delay,\n            ],\n          };\n          let this_effects_css = InjectCssAnimation(\n            this_effects_payload,\n            effects[key]?.paneFragment\n          );\n          css = `${css} ${this_effects_css} `;\n        }\n      }\n      return (\n        <section key={pane?.id}>\n          <IsVisible id={pane?.id} hooks={data?.hooks}>\n            <StyledWrapperDiv\n              className={`pane pane__view pane__view--${data?.state?.viewport?.viewport?.key}`}\n              css={css}\n            >\n              {composedPaneFragments}\n            </StyledWrapperDiv>\n          </IsVisible>\n        </section>\n      );\n    }\n  );\n  // this is the storyFragment\n  return composedPanes;\n}\n\nexport { ComposePanes };\n"],"mappings":"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"}