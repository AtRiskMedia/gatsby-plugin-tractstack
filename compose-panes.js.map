{"version":3,"sources":["src/compose-panes.js"],"names":["React","styled","sanitize","MarkdownInjectGatsbyImage","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","StyledWrapper","div","props","css","StyledInner","children","parent_css","StyledOuter","ComposePanes","data","viewport","key","composedPanes","relationships","field_panes","map","pane","index","field_pane_fragments","pane_fragment","react_fragment","alt_text","imageData","internal","type","field_image","image","id","filename","localFile","childImageSharp","gatsbyImageData","htmlAst","childPaneFragment","childMarkdownRemark","field_cdn_url","field_alt_text","this_image_data","field_svg_file","description","publicURL","field_css_styles","field_css_styles_parent"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport styled from \"styled-components\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport {\n  MarkdownInjectGatsbyImage,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n} from \"./helpers\";\n\nconst StyledWrapper = styled.div`\n  ${(props) => props.css};\n`;\nconst StyledInner = ({ children, css, parent_css }) => {\n  return (\n    <StyledWrapper css={parent_css}>\n      <div className=\"paneFragment\">\n        <StyledWrapper css={css}>{children}</StyledWrapper>\n      </div>\n    </StyledWrapper>\n  );\n};\nconst StyledOuter = ({ children, css }) => {\n  return (\n    <StyledWrapper css={css}>\n      <div className=\"storyFragment\">{children}</div>\n    </StyledWrapper>\n  );\n};\n\nconst ComposePanes = (data) => {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.viewport?.key === \"undefined\") return <></>;\n  // loop through the panes and render each pane fragment\n  const composedPanes = data?.data?.relationships?.field_panes.map(\n    (pane, index) => {\n      // compose each pane fragment\n      return pane?.relationships?.field_pane_fragments.map(\n        (pane_fragment, index) => {\n          let react_fragment, alt_text, imageData;\n\n          // switch on internal.type\n          switch (pane_fragment?.internal?.type) {\n            case \"paragraph__markdown\":\n              // get image data (if available)\n              imageData = pane_fragment?.relationships?.field_image?.map(\n                (image) => {\n                  return [\n                    image.id,\n                    image.filename,\n                    image.localFile?.childImageSharp?.gatsbyImageData,\n                  ];\n                }\n              );\n\n              // replaces images with Gatsby Images and prepares html\n              let htmlAst = sanitize(\n                pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst\n              );\n              react_fragment = MarkdownInjectGatsbyImage(htmlAst, imageData);\n              break;\n\n            case \"paragraph__background_video\":\n              react_fragment = InjectGatsbyBackgroundVideo(\n                pane_fragment?.id,\n                pane_fragment?.field_cdn_url,\n                pane_fragment?.field_alt_text\n              );\n              break;\n\n            case \"paragraph__background_image\":\n              // create Gatsby Background Image ... imageData[2] has the image\n              imageData = pane_fragment?.relationships?.field_image?.map(\n                (image) => {\n                  let key = data?.viewport?.key;\n                  let this_image_data = image[key];\n                  if (typeof this_image_data !== \"undefined\") {\n                    return this_image_data.childImageSharp?.gatsbyImageData;\n                  }\n                }\n              );\n              react_fragment = InjectGatsbyBackgroundImage(\n                imageData[0],\n                pane_fragment?.field_alt_text\n              );\n              break;\n\n            case \"paragraph__svg\":\n              alt_text = pane_fragment?.field_svg_file?.description;\n              let publicURL =\n                pane_fragment?.relationships?.field_svg_file?.localFile\n                  ?.publicURL;\n              react_fragment = InjectSvg(publicURL, alt_text);\n              break;\n\n            case \"paragraph__d3\":\n              //\n              break;\n\n            case \"paragraph__h5p\":\n              //\n              break;\n          }\n\n          return (\n            <StyledInner\n              key={index}\n              css={pane_fragment?.field_css_styles}\n              parent_css={pane_fragment?.field_css_styles_parent}\n            >\n              {react_fragment}\n            </StyledInner>\n          );\n        }\n      );\n    }\n  );\n  return <StyledOuter css={data?.parent_css}>{composedPanes}</StyledOuter>;\n};\n\nexport { ComposePanes };\n"],"file":"compose-panes.js"}