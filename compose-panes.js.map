{"version":3,"sources":["src/compose-panes.js"],"names":["React","useRef","sanitize","MarkdownParagraph","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","StyledWrapper","IsVisible","ComposePanes","data","viewport","key","composedPanes","relationships","field_panes","map","pane","composedPane","field_pane_fragments","filter","e","field_hidden_viewports","replace","split","indexOf","pane_fragment","index","react_fragment","alt_text","imageData","css_styles","css_styles_parent","field_css_styles_mobile","field_css_styles_parent_mobile","field_css_styles_tablet","field_css_styles_parent_tablet","field_css_styles_desktop","field_css_styles_parent_desktop","internal","type","field_image","image","id","filename","localFile","childImageSharp","gatsbyImageData","htmlAst","childPaneFragment","childMarkdownRemark","field_zindex","field_cdn_url","field_alt_text","this_image_data","field_svg_file","description","publicURL","in","out","speed","pane_height","field_height_ratio_mobile","field_height_ratio_tablet","field_height_ratio_desktop","Object","keys","length","parseInt"],"mappings":"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","sourcesContent":["import React, { useRef } from \"react\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  StyledWrapper,\n} from \"./helpers\";\nimport { IsVisible } from \"./is-visible.js\";\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.viewport?.key === \"undefined\") return <></>;\n  // loop through the panes in view and render each pane fragment\n  const composedPanes = data?.data?.relationships?.field_panes.map((pane) => {\n    let composedPane = pane?.relationships?.field_pane_fragments\n      // skip if current viewport is listed in field_hidden_viewports\n      .filter(\n        (e) =>\n          e.field_hidden_viewports\n            .replace(/\\s+/g, \"\")\n            .split(\",\")\n            .indexOf(data?.viewport?.key) == -1\n      )\n      .map((pane_fragment, index) => {\n        let react_fragment,\n          alt_text,\n          imageData,\n          css_styles = \"\",\n          css_styles_parent = \"\";\n        switch (data?.viewport?.key) {\n          case \"mobile\":\n            css_styles = pane_fragment?.field_css_styles_mobile;\n            css_styles_parent = pane_fragment?.field_css_styles_parent_mobile;\n            break;\n          case \"tablet\":\n            css_styles = pane_fragment?.field_css_styles_tablet;\n            css_styles_parent = pane_fragment?.field_css_styles_parent_tablet;\n            break;\n          case \"desktop\":\n            css_styles = pane_fragment?.field_css_styles_desktop;\n            css_styles_parent = pane_fragment?.field_css_styles_parent_desktop;\n            break;\n        }\n        // render this paneFragment\n        switch (pane_fragment?.internal?.type) {\n          case \"paragraph__markdown\":\n            // get image data (if available)\n            imageData = pane_fragment?.relationships?.field_image?.map(\n              (image) => {\n                return [\n                  image.id,\n                  image.filename,\n                  image.localFile?.childImageSharp?.gatsbyImageData,\n                ];\n              }\n            );\n            // replaces images with Gatsby Images and prepares html\n            let htmlAst = sanitize(\n              pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst\n            );\n            react_fragment = MarkdownParagraph(\n              htmlAst,\n              imageData,\n              index,\n              css_styles_parent,\n              css_styles,\n              pane_fragment?.field_zindex\n            );\n            break;\n\n          case \"paragraph__background_video\":\n            react_fragment = InjectGatsbyBackgroundVideo(\n              pane_fragment?.id,\n              pane_fragment?.field_cdn_url,\n              pane_fragment?.field_alt_text,\n              index,\n              css_styles_parent,\n              pane_fragment?.field_zindex\n            );\n            break;\n\n          case \"paragraph__background_image\":\n            imageData = pane_fragment?.relationships?.field_image?.map(\n              (image) => {\n                let key = data?.viewport?.key;\n                let this_image_data = image[key];\n                if (typeof this_image_data !== \"undefined\") {\n                  return this_image_data.childImageSharp?.gatsbyImageData;\n                }\n              }\n            );\n            react_fragment = InjectGatsbyBackgroundImage(\n              imageData[0],\n              pane_fragment?.field_alt_text,\n              index,\n              css_styles_parent,\n              pane_fragment?.field_zindex\n            );\n            break;\n\n          case \"paragraph__svg\":\n            alt_text = pane_fragment?.field_svg_file?.description;\n            let publicURL =\n              pane_fragment?.relationships?.field_svg_file?.localFile\n                ?.publicURL;\n            react_fragment = InjectSvg(\n              publicURL,\n              alt_text,\n              index,\n              css_styles_parent,\n              pane_fragment?.field_zindex\n            );\n            break;\n\n          case \"paragraph__d3\":\n            //\n            break;\n\n          case \"paragraph__h5p\":\n            //\n            break;\n        }\n        return (\n          <div className=\"paneFragment\">\n            <IsVisible\n              key={pane_fragment?.id}\n              payload={{ in: \"fadeInUp\", out: \"fadeOut\", speed: \"2\" }}\n            >\n              {react_fragment}\n            </IsVisible>\n          </div>\n        );\n      });\n\n    // return pane\n    let pane_height;\n    switch (data?.viewport?.key) {\n      case \"mobile\":\n        pane_height = pane?.field_height_ratio_mobile;\n        break;\n      case \"tablet\":\n        pane_height = pane?.field_height_ratio_tablet;\n        break;\n      case \"desktop\":\n        pane_height = pane?.field_height_ratio_desktop;\n        break;\n    }\n    // at this viewport the pane may be empty\n    if (Object.keys(composedPane).length === 0) return;\n    return (\n      <StyledWrapper\n        key={pane?.id}\n        className={\"pane pane__view--\" + data?.viewport?.key}\n        css={\"height:\" + parseInt(pane_height) + \"vw;\"}\n      >\n        {composedPane}\n      </StyledWrapper>\n    );\n  });\n  // this is the storyFragment\n  return composedPanes;\n}\n\nexport { ComposePanes };\n"],"file":"compose-panes.js"}