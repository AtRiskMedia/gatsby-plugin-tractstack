{"version":3,"file":"compose-panes.js","names":["React","useRef","renderToStaticMarkup","animateScrollTo","IsVisible","MarkdownParagraph","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","InjectSvgShape","TextShapeOutside","StyledWrapperDiv","InjectCssAnimation","getCurrentPane","SvgPane","ComposePanes","data","state","viewport","key","visiblePane","currentPane","panes","ref","document","getElementById","css","imageMaskShape","textShapeOutside","composedPanes","fragments","relationships","field_panes","map","pane","i","background_colour","field_pane_fragments","filter","e","internal","type","pane_height","height_offset","field_height_ratio_mobile","field_height_offset_mobile","field_image_mask_shape_mobile","imageMaskShapeSelector","id","selector","shape","field_height_ratio_tablet","field_height_offset_tablet","field_image_mask_shape_tablet","field_height_ratio_desktop","field_height_offset_desktop","field_image_mask_shape_desktop","console","log","composedPaneFragments","field_hidden_viewports","replace","split","indexOf","sort","a","b","field_zindex","pane_fragment","index","react_fragment","alt_text","imageData","css_styles","css_styles_parent","field_css_styles_mobile","field_css_styles_parent_mobile","field_shape_mobile","field_text_shape_outside_mobile","field_css_styles_tablet","field_css_styles_parent_tablet","field_shape_tablet","field_text_shape_outside_tablet","field_css_styles_desktop","field_css_styles_parent_desktop","field_shape_desktop","field_text_shape_outside_desktop","action","buttonData","child","childPaneFragment","childMarkdownRemark","htmlAst","children","value","JSON","parse","field_options","buttons","SyntaxError","field_image","hooks","field_cdn_url","field_alt_text","field_svg_file","localFile","publicURL","description","thisClass","Object","keys","length","field_background_colour","svgString","b64","window","btoa","dataUri","effects_payload","prefersReducedMotion","effects","controller","payload","in","function","speed","delay","this_effects_css","paneFragment"],"sources":["src/compose-panes.js"],"sourcesContent":["import React, { useRef } from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport animateScrollTo from \"animated-scroll-to\";\nimport { IsVisible } from \"./is-visible.js\";\nimport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  InjectSvgShape,\n  TextShapeOutside,\n  StyledWrapperDiv,\n  InjectCssAnimation,\n  getCurrentPane,\n} from \"./helpers\";\nimport { SvgPane } from \"./shapes\";\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.state?.viewport?.viewport?.key === \"undefined\") return <></>;\n\n  // is there a current pane to scroll to?\n  let visiblePane = getCurrentPane(\n    data?.state?.viewport?.currentPane,\n    data?.state?.viewport?.panes\n  );\n  if (visiblePane) {\n    let ref = document.getElementById(visiblePane);\n    if (ref) animateScrollTo(ref);\n  }\n\n  // loop through the panes in view and render each pane fragment\n  let css = \"\",\n    imageMaskShape,\n    textShapeOutside;\n\n  const composedPanes = data?.fragments?.relationships?.field_panes.map(\n    (pane, i) => {\n      // check for background colour\n      let background_colour = pane?.relationships?.field_pane_fragments.filter(\n        (e) => e?.internal?.type === \"paragraph__background_colour\"\n      );\n      // compose this pane\n      let pane_height, height_offset;\n      switch (data?.state?.viewport?.viewport?.key) {\n        case \"mobile\":\n          pane_height = `calc((100vw - (var(--offset) * 1px)) * ${pane?.field_height_ratio_mobile} / 100)`;\n          height_offset = `calc((100vw - (var(--offset) * 1px)) / 600 * ${pane?.field_height_offset_mobile})`;\n          imageMaskShape = pane?.relationships?.field_pane_fragments\n            .filter((e) => e?.field_image_mask_shape_mobile)\n            .map((e) => {\n              let imageMaskShapeSelector;\n              if (e?.internal?.type === \"paragraph__background_video\")\n                imageMaskShapeSelector = \".paneFragmentVideo\";\n              else imageMaskShapeSelector = `div#${e?.id}`;\n              return {\n                selector: `div#${e?.id}`,\n                shape: SvgPane(\n                  e?.field_image_mask_shape_mobile,\n                  data?.state?.viewport?.viewport?.key\n                ),\n              };\n            });\n          break;\n        case \"tablet\":\n          pane_height = `calc((100vw - (var(--offset) * 1px)) * ${pane?.field_height_ratio_tablet} / 100)`;\n          height_offset = `calc((100vw - (var(--offset) * 1px)) / 1080 * ${pane?.field_height_offset_tablet})`;\n          imageMaskShape = pane?.relationships?.field_pane_fragments\n            .filter((e) => e?.field_image_mask_shape_tablet)\n            .map((e) => {\n              let imageMaskShapeSelector;\n              if (e?.internal?.type === \"paragraph__background_video\")\n                imageMaskShapeSelector = \".paneFragmentVideo\";\n              else imageMaskShapeSelector = `div#${e?.id}`;\n              return {\n                selector: imageMaskShapeSelector,\n                shape: SvgPane(\n                  e?.field_image_mask_shape_tablet,\n                  data?.state?.viewport?.viewport?.key\n                ),\n              };\n            });\n          break;\n        case \"desktop\":\n          pane_height = `calc((100vw - (var(--offset) * 1px)) * ${pane?.field_height_ratio_desktop} / 100)`;\n          height_offset = `calc((100vw - (var(--offset) * 1px)) / 1920 * ${pane?.field_height_offset_desktop})`;\n          imageMaskShape = pane?.relationships?.field_pane_fragments\n            .filter((e) => e?.field_image_mask_shape_desktop)\n            .map((e) => {\n              let imageMaskShapeSelector;\n              if (e?.internal?.type === \"paragraph__background_video\")\n                imageMaskShapeSelector = \".paneFragmentVideo\";\n              else imageMaskShapeSelector = `div#${e?.id}`;\n              console.log(imageMaskShapeSelector);\n              return {\n                selector: `div#${e?.id}`,\n                shape: SvgPane(\n                  e?.field_image_mask_shape_desktop,\n                  data?.state?.viewport?.viewport?.key\n                ),\n              };\n            });\n          break;\n      }\n\n      // now compose the paneFragments for this pane\n      let composedPaneFragments = pane?.relationships?.field_pane_fragments\n        // skip if current viewport is listed in field_hidden_viewports\n        .filter(\n          (e) =>\n            e.field_hidden_viewports\n              .replace(/\\s+/g, \"\")\n              .split(\",\")\n              .indexOf(data?.state?.viewport?.viewport?.key) == -1\n        )\n        // already processed background_colour\n        .filter((e) => e?.internal?.type !== \"paragraph__background_colour\")\n        // sort by zIndex ***important\n        .sort((a, b) => (a?.field_zindex > b?.field_zindex ? 1 : -1))\n        .map((pane_fragment, index) => {\n          let react_fragment,\n            alt_text,\n            imageData,\n            shape,\n            css_styles,\n            css_styles_parent;\n\n          // select css for viewport\n          switch (data?.state?.viewport?.viewport?.key) {\n            case \"mobile\":\n              css_styles = pane_fragment?.field_css_styles_mobile || \"\";\n              css_styles_parent =\n                pane_fragment?.field_css_styles_parent_mobile || \"\";\n              if (\n                pane_fragment?.internal?.type === \"paragraph__background_pane\"\n              )\n                shape = pane_fragment?.field_shape_mobile;\n              if (pane_fragment?.field_text_shape_outside_mobile) {\n                textShapeOutside = TextShapeOutside(\n                  pane_fragment?.field_text_shape_outside_mobile,\n                  data?.state?.viewport?.viewport?.key\n                );\n              }\n              break;\n            case \"tablet\":\n              css_styles = pane_fragment?.field_css_styles_tablet || \"\";\n              css_styles_parent =\n                pane_fragment?.field_css_styles_parent_tablet || \"\";\n              if (\n                pane_fragment?.internal?.type === \"paragraph__background_pane\"\n              )\n                shape = pane_fragment?.field_shape_tablet;\n              if (pane_fragment?.field_text_shape_outside_tablet) {\n                textShapeOutside = TextShapeOutside(\n                  pane_fragment?.field_text_shape_outside_tablet,\n                  data?.state?.viewport?.viewport?.key\n                );\n              }\n              break;\n            case \"desktop\":\n              css_styles = pane_fragment?.field_css_styles_desktop || \"\";\n              css_styles_parent =\n                pane_fragment?.field_css_styles_parent_desktop || \"\";\n              if (\n                pane_fragment?.internal?.type === \"paragraph__background_pane\"\n              )\n                shape = pane_fragment?.field_shape_desktop;\n              if (pane_fragment?.field_text_shape_outside_desktop) {\n                textShapeOutside = TextShapeOutside(\n                  pane_fragment?.field_text_shape_outside_desktop,\n                  data?.state?.viewport?.viewport?.key\n                );\n              }\n              break;\n          }\n\n          // render this paneFragment\n          switch (pane_fragment?.internal?.type) {\n            case \"paragraph__markdown\":\n              // now pre-render MarkdownParagraph elements and inject images\n              let action,\n                buttonData = {};\n              let child =\n                pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst;\n              child.children =\n                pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst?.children?.filter(\n                  (e) => !(e.type === \"text\" && e.value === \"\\n\")\n                );\n              try {\n                action = JSON.parse(pane_fragment?.field_options);\n                if (typeof action?.buttons === \"object\")\n                  buttonData = action?.buttons;\n              } catch (e) {\n                if (e instanceof SyntaxError) {\n                  console.log(\"ERROR parsing json in {}: \", e);\n                }\n              }\n              react_fragment = MarkdownParagraph(\n                pane_fragment?.id,\n                child,\n                pane_fragment?.relationships?.field_image,\n                buttonData,\n                {\n                  textShapeOutside: textShapeOutside,\n                },\n                css_styles_parent,\n                css_styles,\n                pane_fragment?.field_zindex,\n                data?.hooks\n              );\n              break;\n\n            case \"paragraph__background_pane\":\n              react_fragment = InjectSvgShape(\n                pane_fragment?.id,\n                shape,\n                data?.state?.viewport?.viewport?.key,\n                css_styles_parent,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__background_video\":\n              react_fragment = InjectGatsbyBackgroundVideo(\n                pane_fragment?.id,\n                pane_fragment?.field_cdn_url,\n                pane_fragment?.field_alt_text,\n                css_styles_parent,\n                css_styles,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__background_image\":\n              react_fragment = InjectGatsbyBackgroundImage(\n                pane_fragment?.id,\n                pane_fragment?.relationships?.field_image[0] &&\n                  pane_fragment?.relationships?.field_image[0][\n                    data?.state?.viewport?.viewport?.key\n                  ],\n                pane_fragment?.field_alt_text,\n                css_styles_parent,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__svg\":\n              react_fragment = InjectSvg(\n                pane_fragment?.id,\n                pane_fragment?.relationships?.field_svg_file?.localFile\n                  ?.publicURL,\n                pane_fragment?.field_svg_file?.description,\n                css_styles_parent,\n                pane_fragment?.field_zindex\n              );\n              break;\n\n            case \"paragraph__d3\":\n              //\n              break;\n\n            case \"paragraph__h5p\":\n              //\n              break;\n          }\n          let thisClass = `paneFragment paneFragment__view--${data?.state?.viewport?.viewport?.key}`;\n          return (\n            <div className={thisClass} key={pane_fragment?.id}>\n              <IsVisible\n                id={pane_fragment?.id}\n                className=\"paneFragment\"\n                key={pane_fragment?.id}\n              >\n                {react_fragment}\n              </IsVisible>\n            </div>\n          );\n        });\n\n      // skip if empty pane\n      if (Object.keys(composedPaneFragments).length === 0) return;\n\n      // prepare css for pane\n      css = `${css} height: ${pane_height}; margin-bottom: ${height_offset};`;\n      if (background_colour.length)\n        css = `${css} background-color: ${background_colour[0].field_background_colour};`;\n\n      // inject imageMaskShape(s) (if available)\n      imageMaskShape.map((e) => {\n        if (typeof e?.shape === \"object\") {\n          let svgString = renderToStaticMarkup(e?.shape);\n          let b64 = window.btoa(svgString);\n          let dataUri = `data:image/svg+xml;base64,${b64}`;\n          css =\n            `${css} ${e?.selector} {-webkit-mask-image: url(\"${dataUri}\"); mask-image: url(\"${dataUri}\");` +\n            ` mask-repeat: no-repeat; -webkit-mask-size: 100% AUTO; mask-size: 100% AUTO; }`;\n        }\n      });\n\n      // may we wrap this in animation?\n      let effects_payload = {};\n      if (data?.state?.prefersReducedMotion?.prefersReducedMotion === false) {\n        let effects = data?.state?.controller?.payload?.effects;\n        let effects_payload;\n        for (const key in effects) {\n          if (effects[key]?.pane === pane?.id) {\n            effects_payload = {\n              in: [\n                effects[key]?.function,\n                effects[key]?.speed,\n                effects[key]?.delay,\n              ],\n            };\n            let this_effects_css = InjectCssAnimation(\n              effects_payload,\n              effects[key]?.paneFragment\n            );\n            css = css + this_effects_css;\n          }\n        }\n      }\n      return (\n        <section key={pane?.id}>\n          <IsVisible id={pane?.id} hooks={data?.hooks}>\n            <StyledWrapperDiv\n              className={`pane pane__view pane__view--${data?.state?.viewport?.viewport?.key}`}\n              css={css}\n            >\n              {composedPaneFragments}\n            </StyledWrapperDiv>\n          </IsVisible>\n        </section>\n      );\n    }\n  );\n  // this is the storyFragment\n  return composedPanes;\n}\n\nexport { ComposePanes };\n"],"mappings":"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"}