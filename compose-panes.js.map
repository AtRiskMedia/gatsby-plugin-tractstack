{"version":3,"sources":["src/compose-panes.js"],"names":["React","useEffect","useRef","sanitize","MarkdownParagraph","InjectGatsbyBackgroundImage","InjectGatsbyBackgroundVideo","InjectSvg","ComposePanes","data","viewport","key","console","log","composedPanes","relationships","field_panes","map","pane","composedPane","field_pane_fragments","pane_fragment","index","field_hidden_viewports","replace","split","indexOf","react_fragment","alt_text","imageData","internal","type","field_image","image","id","filename","localFile","childImageSharp","gatsbyImageData","htmlAst","childPaneFragment","childMarkdownRemark","css_styles","css_styles_parent","field_css_styles_mobile","field_css_styles_parent_mobile","field_css_styles_tablet","field_css_styles_parent_tablet","field_css_styles_desktop","field_css_styles_parent_desktop","field_zindex","field_cdn_url","field_alt_text","this_image_data","field_svg_file","description","publicURL"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n} from \"./helpers\";\n\nfunction ComposePanes(data) {\n  // if viewport is not yet defined, return empty fragment\n  if (typeof data?.viewport?.key === \"undefined\") return <></>;\n  console.log(\"*\", data?.viewport?.key);\n  // loop through the panes in view and render each pane fragment\n  const composedPanes = data?.data?.relationships?.field_panes.map((pane) => {\n    const composedPane = pane?.relationships?.field_pane_fragments.map(\n      (pane_fragment, index) => {\n        // skip if current viewport is listed in field_hidden_viewports\n        if (\n          pane_fragment?.field_hidden_viewports\n            .replace(/\\s+/g, \"\")\n            .split(\",\")\n            .indexOf(data?.viewport?.key) > -1\n        ) {\n          return;\n        }\n        let react_fragment, alt_text, imageData;\n        switch (pane_fragment?.internal?.type) {\n          case \"paragraph__markdown\":\n            // get image data (if available)\n            imageData = pane_fragment?.relationships?.field_image?.map(\n              (image) => {\n                return [\n                  image.id,\n                  image.filename,\n                  image.localFile?.childImageSharp?.gatsbyImageData,\n                ];\n              }\n            );\n            // replaces images with Gatsby Images and prepares html\n            let htmlAst = sanitize(\n              pane_fragment?.childPaneFragment?.childMarkdownRemark?.htmlAst\n            );\n            let css_styles, css_styles_parent;\n            switch (data?.viewport?.key) {\n              case \"mobile\":\n                css_styles = pane_fragment?.field_css_styles_mobile;\n                css_styles_parent =\n                  pane_fragment?.field_css_styles_parent_mobile;\n                break;\n              case \"tablet\":\n                css_styles = pane_fragment?.field_css_styles_tablet;\n                css_styles_parent =\n                  pane_fragment?.field_css_styles_parent_tablet;\n                break;\n              case \"desktop\":\n                css_styles = pane_fragment?.field_css_styles_desktop;\n                css_styles_parent =\n                  pane_fragment?.field_css_styles_parent_desktop;\n                break;\n            }\n            react_fragment = MarkdownParagraph(\n              htmlAst,\n              imageData,\n              index,\n              css_styles_parent,\n              css_styles,\n              pane_fragment?.field_zindex\n            );\n            break;\n\n          case \"paragraph__background_video\":\n            react_fragment = InjectGatsbyBackgroundVideo(\n              pane_fragment?.id,\n              pane_fragment?.field_cdn_url,\n              pane_fragment?.field_alt_text,\n              index\n            );\n            break;\n\n          case \"paragraph__background_image\":\n            imageData = pane_fragment?.relationships?.field_image?.map(\n              (image) => {\n                let key = data?.viewport?.key;\n                let this_image_data = image[key];\n                if (typeof this_image_data !== \"undefined\") {\n                  return this_image_data.childImageSharp?.gatsbyImageData;\n                }\n              }\n            );\n            react_fragment = InjectGatsbyBackgroundImage(\n              imageData[0],\n              pane_fragment?.field_alt_text,\n              index\n            );\n            break;\n\n          case \"paragraph__svg\":\n            alt_text = pane_fragment?.field_svg_file?.description;\n            let publicURL =\n              pane_fragment?.relationships?.field_svg_file?.localFile\n                ?.publicURL;\n            react_fragment = InjectSvg(publicURL, alt_text, index);\n            break;\n\n          case \"paragraph__d3\":\n            //\n            break;\n\n          case \"paragraph__h5p\":\n            //\n            break;\n        }\n        return react_fragment;\n      }\n    );\n    return (\n      <div key={pane?.id} className={\"pane pane__view--\" + data?.viewport?.key}>\n        {composedPane}\n      </div>\n    );\n  });\n  return composedPanes;\n}\n\nexport { ComposePanes };\n"],"file":"compose-panes.js"}