{"version":3,"file":"helpers.js","names":["React","sanitize","styled","graphql","useStaticQuery","Link","getImage","GatsbyImage","convertToBgImage","BackgroundImage","SvgPane","lispLexer","getCurrentPane","paneId","panes","getScrollbarSize","window","body","document","scrollDiv","createElement","setAttribute","appendChild","calculateValue","type","scrollbarWidth","removeChild","lispCallback","payload","context","hooks","icon","lisp_data","Object","keys","command","parameter_one","parameter_two","parameter_three","console","log","alert","hookGotoStoryFragment","hookSetCurrentPane","HtmlAstToReact","children","imageData","buttonData","maskData","contents","raw","fragment","map","e","index","value","tagName","Tag","properties","href","is_button","length","key","find","target","urlTarget","callbackPayload","payload_ast","injectPayload","className","pass","extcheck","src","match","this_imageData","filter","image","filename","localFile","childImageSharp","gatsbyImageData","alt","p","i","props","list","li","StyledWrapperDiv","div","css","StyledWrapperSection","section","PaneFragment","id","child","this_css","InjectSvgShape","shape","viewport","parent_css","zIndex","parseInt","InjectSvg","url","alt_text","InjectGatsbyBackgroundImage","bgImage","InjectGatsbyBackgroundVideo","child_css","MarkdownParagraph","htmlAst","paragraph","getStoryStepGraph","graph","targetId","edges","node","InjectCssAnimation","paneFragmentId","selector","animationIn","in","animationInSpeed","animationInDelay","TextShapeOutside"],"sources":["src/helpers.js"],"sourcesContent":["import React from \"react\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport styled from \"styled-components\";\nimport { graphql, useStaticQuery, Link } from \"gatsby\";\nimport { getImage, GatsbyImage } from \"gatsby-plugin-image\";\nimport { convertToBgImage } from \"gbimage-bridge\";\nimport BackgroundImage from \"gatsby-background-image\";\nimport { SvgPane } from \"./shapes\";\nimport { lispLexer } from \"./lexer\";\n\nconst getCurrentPane = (paneId = \"\", panes = []) => {\n  if (!paneId) return panes[0];\n  // return first element in panes\n  return paneId;\n};\n\n// from https://tobbelindstrom.com/blog/measure-scrollbar-width-and-height/\nconst getScrollbarSize = () => {\n  if (typeof window !== \"undefined\") {\n    const { body } = document;\n    const scrollDiv = document.createElement(\"div\");\n\n    // Append element with defined styling\n    scrollDiv.setAttribute(\n      \"style\",\n      \"width: 1337px; height: 1337px; position: absolute; left: -9999px; overflow: scroll;\"\n    );\n    body.appendChild(scrollDiv);\n\n    // Collect width & height of scrollbar\n    const calculateValue = (type) =>\n      scrollDiv[`offset${type}`] - scrollDiv[`client${type}`];\n    const scrollbarWidth = calculateValue(\"Width\");\n\n    // Remove element\n    body.removeChild(scrollDiv);\n\n    return scrollbarWidth;\n  }\n  return 12;\n};\n\nconst lispCallback = (payload, context = \"\", hooks = []) => {\n  let icon;\n  let lisp_data = payload[Object.keys(payload)[0]];\n  let command = lisp_data[0] || false;\n  let parameter_one, parameter_two, parameter_three;\n  if (typeof lisp_data[1] === \"object\") {\n    parameter_one = lisp_data[1][0] || false;\n    parameter_two = lisp_data[1][1] || false;\n    parameter_three = lisp_data[1][2] || false;\n  }\n  // now process the command\n  switch (command) {\n    case \"icon\":\n      // pre-process on context\n      switch (context) {\n        case \"paneVisible\":\n          // process as \"icon\" function\n          icon = parameter_one;\n          command = parameter_two[0];\n          parameter_one = parameter_two[1];\n          parameter_two = parameter_three;\n          parameter_three = false;\n          console.log(`todo: add ${icon} icon to controller`);\n          // TODO: do something with the icon\n          break;\n\n        case \"paneHidden\":\n          // process as \"icon\" function\n          icon = parameter_one;\n          command = parameter_two[0];\n          parameter_one = parameter_two[1];\n          parameter_two = parameter_three;\n          parameter_three = false;\n          console.log(`todo: remove ${icon} icon to controller`);\n          // TODO: do something with the icon\n          break;\n      }\n      break;\n\n    case \"alert\":\n      alert(parameter_one);\n      break;\n\n    case \"goto\":\n      // calls hooks.hookGotoStoryFragment for gatsby navigate\n      if (\n        parameter_one === \"storyFragment\" &&\n        typeof parameter_two === \"string\"\n      )\n        hooks.hookGotoStoryFragment(`/${parameter_two}`);\n      if (parameter_one === \"pane\" && typeof parameter_two === \"string\")\n        hooks.hookSetCurrentPane(parameter_two);\n      break;\n\n    default:\n      console.log(\"MISS on helpers.js lispCallback:\", context, command);\n  }\n};\n\nconst HtmlAstToReact = (\n  children,\n  imageData = [],\n  buttonData = [],\n  maskData = [],\n  hooks = []\n) => {\n  // recursive function\n  // breaks gatsby images free of enclosing p tag\n  let contents, raw;\n  const fragment = children.map((e, index) => {\n    if (e?.type === \"text\") return <span key={index}>{e?.value}</span>;\n    switch (e?.tagName) {\n      case \"h1\":\n      case \"h2\":\n      case \"h3\":\n      case \"h4\":\n      case \"h5\":\n      case \"h6\":\n        const Tag = e?.tagName;\n        return (\n          <div key={index}>\n            <Tag>{e?.children[0].value}</Tag>\n          </div>\n        );\n\n      case \"br\":\n        return <br key={index} />;\n\n      case \"em\":\n        if (typeof e?.children[0]?.value === \"string\") {\n          return <em key={index}>{e?.children[0]?.value}</em>;\n        }\n        break;\n\n      case \"strong\":\n        if (typeof e?.children[0]?.value === \"string\") {\n          return <strong key={index}>{e?.children[0]?.value}</strong>;\n        }\n        break;\n\n      case \"a\":\n        if (\n          typeof e?.properties?.href === \"string\" &&\n          e?.children[0]?.type === \"text\" &&\n          typeof e?.children[0]?.value === \"string\"\n        ) {\n          // check for buttons action payload\n          let is_button;\n          if (\n            typeof buttonData === \"object\" &&\n            Object.keys(buttonData).length\n          ) {\n            let key = Object.keys(buttonData).find(\n              (target) => buttonData[target]?.urlTarget === e?.properties?.href\n            );\n            is_button = buttonData[key];\n          }\n          if (is_button) {\n            // inject button with callback function, add css className\n            let payload = is_button?.callbackPayload;\n            let payload_ast = lispLexer(payload);\n            function injectPayload() {\n              lispCallback(payload_ast[0], \"button\", hooks);\n            }\n            return (\n              <button\n                key={index}\n                className={is_button?.className}\n                onClick={() => injectPayload()}\n              >\n                {e?.children[0]?.value}\n              </button>\n            );\n          }\n\n          // else, treat at internal link\n          // ...TODO: add check here and use a href for external links\n          return (\n            <a\n              onClick={() => hooks?.hookGotoStoryFragment(e?.properties?.href)}\n              key={index}\n            >\n              {e?.children[0]?.value}\n            </a>\n          );\n        }\n        break;\n\n      case \"img\":\n        // is this case for gatsby image? = png, jpg ... != svg\n        let pass = /\\.[A-Za-z0-9]+$/;\n        let extcheck = e?.properties?.src?.match(pass);\n        if (extcheck && (extcheck[0] === \".png\" || extcheck[0] === \".jpg\")) {\n          // imageData in this case is an array ... assumes image is first element\n          let this_imageData = imageData.filter(\n            (image) => image.filename === e?.properties?.src\n          )[0]?.localFile?.childImageSharp?.gatsbyImageData;\n          let image = (\n            <GatsbyImage\n              key={index}\n              alt={e?.properties?.alt}\n              image={this_imageData}\n            />\n          );\n          return image;\n        }\n        break;\n\n      case \"p\":\n        contents = e?.children?.map((p, i) => {\n          // use recursion to compose the MarkdownParagraph\n          return HtmlAstToReact([p], imageData, buttonData, maskData, hooks);\n        });\n        // is this an image?\n        if (contents.length === 1 && contents[0][0].props?.image) {\n          return <div key={index}>{contents[0][0]}</div>;\n        }\n        return (\n          <div key={index}>\n            <p>{contents}</p>\n          </div>\n        );\n\n      case \"ul\":\n      case \"ol\":\n        raw = e?.children.filter(\n          (e) => !(e.type === \"text\" && e.value === \"\\n\")\n        );\n        contents = HtmlAstToReact(raw, imageData, buttonData, maskData, hooks);\n        let list;\n        if (e?.tagName === \"ol\") list = <ol>{contents}</ol>;\n        if (e?.tagName === \"ul\") list = <ul>{contents}</ul>;\n        return <div key={index}>{list}</div>;\n\n      case \"li\":\n        contents = e?.children?.map((li, i) => {\n          // use recursion to compose the MarkdownParagraph\n          return HtmlAstToReact([li], imageData, buttonData, maskData, hooks);\n        });\n        return <li key={index}>{contents}</li>;\n\n      case \"blockquote\":\n        raw = e?.children.filter(\n          (e) => !(e.type === \"text\" && e.value === \"\\n\")\n        );\n        let contents = HtmlAstToReact(\n          raw,\n          imageData,\n          buttonData,\n          maskData,\n          hooks\n        );\n        if (typeof e?.children[0]?.value === \"string\") {\n          return <blockquote key={index}>{contents}</blockquote>;\n        }\n        break;\n\n      default:\n        console.log(\"helpers.js: MISS on\", e);\n    }\n  });\n  return fragment;\n};\n\nconst StyledWrapperDiv = styled.div`\n  ${(props) => props.css};\n`;\nconst StyledWrapperSection = styled.section`\n  ${(props) => props.css};\n`;\n\nconst PaneFragment = (id, child, css) => {\n  let this_css = `height:100%; ${css}`;\n  return (\n    <StyledWrapperDiv key={id} css={this_css}>\n      {child}\n    </StyledWrapperDiv>\n  );\n};\n\nconst InjectSvgShape = (id, shape, viewport, parent_css = \"\", zIndex) => {\n  let css = `z-index: ${parseInt(zIndex)};`;\n  if (typeof parent_css === \"string\") css = `${css} ${parent_css}`;\n  let child = SvgPane(shape, viewport);\n  return PaneFragment(id, child, css);\n};\n\nconst InjectSvg = (id, url, alt_text, parent_css = \"\", zIndex) => {\n  let css = `z-index: ${parseInt(zIndex)};`;\n  if (typeof parent_css === \"string\") css = `${css} ${parent_css}`;\n  let child = <img src={url} alt={alt_text} className=\"paneFragmentCSS\" />;\n  return PaneFragment(id, child, css);\n};\n\nconst InjectGatsbyBackgroundImage = (\n  id,\n  imageData,\n  alt_text,\n  parent_css = \"\",\n  zIndex\n) => {\n  const this_imageData = getImage(imageData);\n  const bgImage = convertToBgImage(this_imageData);\n  let css = `z-index: ${parseInt(zIndex)};`;\n  if (typeof parent_css === \"string\") css = `${css} img {${parent_css}}`;\n  let child = (\n    <BackgroundImage Tag=\"section\" {...bgImage} preserveStackingContext>\n      <div className=\"paneFragmentImage\">\n        <GatsbyImage image={this_imageData} alt={alt_text} />\n      </div>\n    </BackgroundImage>\n  );\n  return PaneFragment(id, child, css);\n};\n\nconst InjectGatsbyBackgroundVideo = (\n  id,\n  url,\n  alt_text,\n  parent_css = \"\",\n  child_css = \"\",\n  zIndex\n) => {\n  let css = `z-index: ${parseInt(zIndex)};`;\n  if (typeof parent_css === \"string\") css = `${css} ${parent_css}`;\n  if (typeof child_css === \"string\") css = `${css} ${child_css}`;\n  let child = (\n    <video\n      autoPlay={true}\n      muted\n      loop\n      title={alt_text}\n      className=\"paneFragmentVideo\"\n    >\n      <source src={url} type=\"video/mp4\" />\n    </video>\n  );\n  return PaneFragment(id, child, css);\n};\n\nconst MarkdownParagraph = (\n  id,\n  htmlAst,\n  imageData = {},\n  buttonData = {},\n  maskData = {},\n  parent_css = \"\",\n  child_css = \"\",\n  zIndex,\n  hooks = []\n) => {\n  const paragraph = HtmlAstToReact(\n    htmlAst?.children,\n    imageData,\n    buttonData,\n    maskData,\n    hooks\n  );\n  let css = `z-index: ${parseInt(zIndex)};`;\n  if (typeof parent_css === \"string\") css = `${css} ${parent_css}`;\n  if (typeof child_css === \"string\") css = `${css} ${child_css}`;\n  return PaneFragment(id, paragraph, css);\n};\n\nconst getStoryStepGraph = (graph, targetId) => {\n  return graph?.edges?.filter((e) => e?.node?.id === targetId)[0];\n};\n\nconst InjectCssAnimation = (payload, paneFragmentId) => {\n  let css = \"\",\n    selector;\n  if (paneFragmentId !== \"tractstack-controller\") {\n    selector = `div#${paneFragmentId}.visible`;\n  } else {\n    selector = \"div#tractstack-controller\";\n  }\n  let animationIn = payload?.in[0],\n    animationInSpeed = payload?.in[1],\n    animationInDelay = payload?.in[2];\n  if (typeof animationIn === \"string\") {\n    css =\n      `${css} ${selector} { height:100%; opacity: 0; animation-fill-mode: both; ` +\n      `animation-name: ${animationIn}; -webkit-animation-name: ${animationIn}; `;\n    if (typeof animationInSpeed === \"number\") {\n      css = `${css} animation-duration: ${animationInSpeed}s; -webkit-animation-duration: ${animationInSpeed}s; `;\n    }\n    if (typeof animationInDelay === \"number\") {\n      css = `${css} animation-delay: ${animationInDelay}s; `;\n    }\n    css = css + \"}\";\n  }\n  return css;\n};\n\nconst TextShapeOutside = (shape, viewport) => {\n  return SvgPane(shape, viewport, \"shape-outside\");\n};\n\nexport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  InjectSvgShape,\n  TextShapeOutside,\n  StyledWrapperDiv,\n  StyledWrapperSection,\n  PaneFragment,\n  getStoryStepGraph,\n  InjectCssAnimation,\n  lispCallback,\n  getCurrentPane,\n  getScrollbarSize,\n};\n"],"mappings":"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"}