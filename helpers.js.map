{"version":3,"file":"helpers.js","names":["React","ReactDOM","sanitize","styled","graphql","useStaticQuery","Link","getImage","GatsbyImage","convertToBgImage","BackgroundImage","Ajv","v4","uuidv4","SvgPane","SvgModal","icon","wordmark","lispLexer","tractStackFragmentSchema","viewportWidth","mobile","tablet","desktop","ajv","validateSchema","fragment","validate","compile","valid","console","log","errors","thisViewportValue","viewport","value","getScrollbarSize","window","body","document","scrollDiv","createElement","setAttribute","appendChild","calculateValue","type","scrollbarWidth","removeChild","lispCallback","payload","context","useHookEndPoint","lispData","Object","keys","command","parameter_one","parameter_two","parameter_three","alert","HtmlAstToReact","element","contents","raw_element","raw","children","composed","map","e","this_id","tagName","p","i","length","props","image","Tag","properties","href","is_button","buttonData","key","find","target","urlTarget","callbackPayload","payload_ast","injectPayload","className","pass","extcheck","src","match","this_imageData","imageData","filter","filename","data","childImageSharp","gatsbyImageData","objectFitMode","mode","alt","li","StyledWrapperDiv","div","css","StyledWrapperSection","section","PaneFragment","id","child","this_css","InjectSvgModal","shape","options","this_width","viewportKey","width","padding_left","padding_top","z_index","getStoryStepGraph","graph","targetId","edges","node","InjectCssAnimation","paneFragmentId","looped","opacity","selector_in","selector_out","animationIn","in","animationInSpeed","animationInDelay","InjectPaneFragment","paragraph","parseInt","parent","maskData","textShapeOutside","left_mask","right_mask","left","right","shapeData","bgImage","parent_css","this_object_fit","this_background_position","backgroundPosition","alt_text","child_css","videoData","url","hookControllerEndPoint","iconsMinimized","getElementById","icon_count","getElementsByTagName","this_uuid","actionsLisp","this_icon","this_icon_found","this_icon_shape","this_li","title","altTitle","addEventListener","classList","add","render","remove","setTimeout","parentNode","HasImageMask","paragraph__background_video","paragraph__background_image","paragraph__svg","paragraph__markdown","HasPaneFragmentType","paragraph__background_pane","paragraph__d3","paragraph__h5p"],"sources":["src/helpers.js"],"sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport styled from \"styled-components\";\nimport { graphql, useStaticQuery, Link } from \"gatsby\";\nimport { getImage, GatsbyImage } from \"gatsby-plugin-image\";\nimport { convertToBgImage } from \"gbimage-bridge\";\nimport BackgroundImage from \"gatsby-background-image\";\nimport Ajv from \"ajv\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { SvgPane, SvgModal, icon, wordmark } from \"./shapes\";\nimport { lispLexer } from \"./lexer\";\nimport { tractStackFragmentSchema } from \"./schema\";\nconst viewportWidth = {\n  mobile: 600,\n  tablet: 1080,\n  desktop: 1920,\n};\n\nconst ajv = new Ajv();\nconst validateSchema = (fragment) => {\n  let validate = ajv.compile(tractStackFragmentSchema);\n  let valid = validate(fragment);\n  if (!valid) {\n    console.log(\n      \"Render error in helpers.js > validateSchema:\",\n      validate.errors,\n      fragment\n    );\n    return false;\n  }\n  return true;\n};\n\nconst thisViewportValue = (viewport, value) => {\n  return value[viewport];\n};\n\n// from https://tobbelindstrom.com/blog/measure-scrollbar-width-and-height/\nconst getScrollbarSize = () => {\n  if (typeof window !== \"undefined\") {\n    const { body } = document;\n    const scrollDiv = document.createElement(\"div\");\n\n    // Append element with defined styling\n    scrollDiv.setAttribute(\n      \"style\",\n      \"width: 1337px; height: 1337px; position: absolute; left: -9999px; overflow: scroll;\"\n    );\n    body.appendChild(scrollDiv);\n\n    // Collect width & height of scrollbar\n    const calculateValue = (type) =>\n      scrollDiv[`offset${type}`] - scrollDiv[`client${type}`];\n    const scrollbarWidth = calculateValue(\"Width\");\n\n    // Remove element\n    body.removeChild(scrollDiv);\n\n    return scrollbarWidth;\n  }\n  return 12;\n};\n\nconst lispCallback = (payload, context = \"\", useHookEndPoint) => {\n  let lispData = payload[Object.keys(payload)[0]];\n  let command = (lispData && lispData[0]) || false;\n  let parameter_one, parameter_two, parameter_three;\n  if (lispData && typeof lispData[1] === \"object\") {\n    parameter_one = lispData[1][0] || false;\n    parameter_two = lispData[1][1] || false;\n    parameter_three = lispData[1][2] || false;\n  }\n  // now process the command\n  switch (command) {\n    case \"controller\":\n      switch (parameter_one) {\n        case \"expand\":\n        case \"minimize\":\n          useHookEndPoint(\"hookController\", parameter_one);\n          break;\n      }\n      break;\n\n    case \"alert\":\n      alert(parameter_one);\n      break;\n\n    case \"goto\":\n      if (\n        parameter_one === \"storyFragment\" &&\n        typeof parameter_two === \"string\"\n      )\n        useHookEndPoint(\"hookGotoStoryFragment\", `/${parameter_two}`);\n      if (parameter_one === \"pane\" && typeof parameter_two === \"string\") {\n        useHookEndPoint(\"hookSetCurrentPane\", parameter_two);\n      }\n      break;\n\n    default:\n      console.log(\"MISS on helpers.js lispCallback:\", context, command);\n  }\n};\n\nconst HtmlAstToReact = (fragment, element = false) => {\n  // recursive function\n  let contents, raw_element, raw;\n  if (element) raw = element;\n  else if (typeof fragment?.children?.children === \"object\")\n    raw = fragment?.children?.children;\n  else return null;\n  const composed = raw.map((e) => {\n    let this_id = uuidv4();\n    if (e?.type === \"text\") return <span key={this_id}>{e?.value}</span>;\n    switch (e?.tagName) {\n      case \"p\":\n        contents = e?.children?.map((p, i) => {\n          // use recursion to compose the MarkdownParagraph\n          return HtmlAstToReact(fragment, [p]);\n        });\n        // is this an image? (only uses first image)\n        if (\n          contents &&\n          contents?.length &&\n          contents[0] &&\n          contents[0][0] &&\n          contents[0][0].props?.image\n        )\n          return <div key={this_id}>{contents[0][0]}</div>;\n        // else it's a paragraph\n        return (\n          <div key={this_id}>\n            <p>{contents}</p>\n          </div>\n        );\n        break;\n\n      case \"h1\":\n      case \"h2\":\n      case \"h3\":\n      case \"h4\":\n      case \"h5\":\n      case \"h6\":\n        const Tag = e?.tagName;\n        return (\n          <div key={this_id}>\n            <Tag>{e?.children[0].value}</Tag>\n          </div>\n        );\n\n      case \"a\":\n        if (\n          typeof e?.properties?.href === \"string\" &&\n          e?.children[0]?.type === \"text\" &&\n          typeof e?.children[0]?.value === \"string\"\n        ) {\n          // check for buttons action payload\n          // requires match on button's urlTarget === link's href\n          let is_button;\n          if (\n            typeof fragment?.payload?.buttonData === \"object\" &&\n            Object.keys(fragment?.payload?.buttonData).length\n          ) {\n            let key = Object.keys(fragment?.payload?.buttonData).find(\n              (target) =>\n                fragment?.payload?.buttonData[target]?.urlTarget ===\n                e?.properties?.href\n            );\n            is_button = fragment?.payload?.buttonData[key];\n          }\n          if (is_button) {\n            // inject button with callback function, add css className\n            let payload = is_button?.callbackPayload;\n            let payload_ast = lispLexer(payload);\n            function injectPayload() {\n              lispCallback(\n                payload_ast[0],\n                \"button\",\n                fragment?.payload?.useHookEndPoint\n              );\n            }\n            return (\n              <button\n                key={this_id}\n                className={is_button?.className}\n                onClick={() => injectPayload()}\n              >\n                {e?.children[0]?.value}\n              </button>\n            );\n          }\n          // else, treat at internal link\n          // ...TODO: add check here and use a href for external links\n          return (\n            <a\n              onClick={() =>\n                fragment?.payload?.useHookEndPoint(\n                  \"hookGotoStoryFragment\",\n                  e?.properties?.href\n                )\n              }\n              key={this_id}\n            >\n              {e?.children[0]?.value}\n            </a>\n          );\n        }\n        break;\n\n      case \"img\":\n        // is this case for gatsby image? = png, jpg ... != svg\n        let pass = /\\.[A-Za-z0-9]+$/;\n        let extcheck = e?.properties?.src?.match(pass);\n        if (extcheck && (extcheck[0] === \".png\" || extcheck[0] === \".jpg\")) {\n          // imageData in this case is an array ... assumes image is first element\n          let this_imageData = fragment?.payload?.imageData?.filter(\n            (image) => image.filename === e?.properties?.src\n          )[0]?.data?.childImageSharp?.gatsbyImageData;\n          let objectFitMode;\n          if (fragment?.mode === \"paragraph__markdown\")\n            objectFitMode = \"contain\";\n          else objectFitMode = \"cover\";\n          let image = (\n            <GatsbyImage\n              key={this_id}\n              alt={e?.properties?.alt}\n              image={this_imageData}\n              objectFit={objectFitMode}\n            />\n          );\n          return image;\n        }\n        break;\n\n      case \"ul\":\n      case \"ol\":\n        raw_element = e?.children.filter(\n          (e) => !(e.type === \"text\" && e.value === \"\\n\")\n        );\n        contents = HtmlAstToReact(fragment, raw_element);\n        if (e?.tagName === \"ol\") contents = <ol>{contents}</ol>;\n        if (e?.tagName === \"ul\") contents = <ul>{contents}</ul>;\n        return <div key={this_id}>{contents}</div>;\n        break;\n\n      case \"li\":\n        contents = e?.children?.map((li, i) => {\n          return HtmlAstToReact(fragment, [li]);\n        });\n        return <li key={this_id}>{contents}</li>;\n        break;\n\n      case \"br\":\n        return <br key={this_id} />;\n\n      case \"em\":\n        if (typeof e?.children[0]?.value === \"string\") {\n          return <em key={this_id}>{e?.children[0]?.value}</em>;\n        }\n        break;\n\n      case \"strong\":\n        if (typeof e?.children[0]?.value === \"string\") {\n          return <strong key={this_id}>{e?.children[0]?.value}</strong>;\n        }\n        break;\n\n      case \"blockquote\":\n        raw_element = e?.children.filter(\n          (e) => !(e.type === \"text\" && e.value === \"\\n\")\n        );\n        contents = HtmlAstToReact(fragment, raw_element);\n        if (typeof e?.children[0]?.value === \"string\") {\n          return <blockquote key={this_id}>{contents}</blockquote>;\n        }\n        break;\n\n      default:\n        console.log(\"helpers.js: MISS on\", e);\n    }\n  });\n  return composed;\n};\n\nconst StyledWrapperDiv = styled.div`\n  ${(props) => props.css};\n`;\nconst StyledWrapperSection = styled.section`\n  ${(props) => props.css};\n`;\n\nconst PaneFragment = (id, child, css) => {\n  let this_css = `height:100%; ${css}`;\n  return (\n    <StyledWrapperDiv key={id} css={this_css}>\n      {child}\n    </StyledWrapperDiv>\n  );\n};\n\nconst InjectSvgModal = (shape, options) => {\n  // react fragment, not tractStackFragment\n  let this_id = `${options?.id}-svg-modal`;\n  let this_width = viewportWidth[options?.viewportKey];\n  let css =\n    `svg { width: calc((100vw - (var(--offset) * 1px)) / ${this_width} * ${options?.width}); ` +\n    `margin-left: calc((100vw - (var(--offset) * 1px)) / ${this_width} * ${options?.padding_left}); ` +\n    `margin-top: calc((100vw - (var(--offset) * 1px)) / ${this_width} * ${options?.padding_top}); ` +\n    `z-index: ${options?.z_index - 2}; ` +\n    `}`;\n  let fragment = PaneFragment(this_id, shape, css);\n  return <div className=\"paneFragmentModal\">{fragment}</div>;\n};\n\nconst getStoryStepGraph = (graph, targetId) => {\n  return graph?.edges?.filter((e) => e?.node?.id === targetId)[0];\n};\n\nconst InjectCssAnimation = (payload, paneFragmentId) => {\n  let css = \"\",\n    looped = \"\",\n    opacity = \"opacity:0;\",\n    selector_in,\n    selector_out;\n  if (paneFragmentId === \"controller\") {\n    selector_in =\n      \"div#controller-container-minimized.visible,div#controller-container-expanded.visible\";\n  } else if (paneFragmentId === \"controller-expand\") {\n    selector_in = \"div.controller__container--expand\";\n    opacity = \"\";\n    looped = \"animation-iteration-count: infinite;\";\n  } else if (paneFragmentId === \"controller-minimize\") {\n    selector_in = \"div.controller__container--minimize\";\n    opacity = \"\";\n    looped = \"animation-iteration-count: infinite;\";\n  } else {\n    selector_in = `div#${paneFragmentId}.visible`;\n    selector_out = `div#${paneFragmentId}.hidden`;\n  }\n  let animationIn = payload?.in[0],\n    animationInSpeed = payload?.in[1],\n    animationInDelay = payload?.in[2];\n  if (typeof animationIn === \"string\") {\n    css =\n      `${css} ${selector_in} { ${opacity} ${looped} animation-fill-mode: both; ` +\n      `animation-name: ${animationIn}; -webkit-animation-name: ${animationIn}; `;\n    if (typeof animationInSpeed === \"number\") {\n      css = `${css} animation-duration: ${animationInSpeed}s; -webkit-animation-duration: ${animationInSpeed}s; `;\n    }\n    if (typeof animationInDelay === \"number\") {\n      css = `${css} animation-delay: ${animationInDelay}s; `;\n    }\n    css = css + \"}\";\n    if (selector_out)\n      css =\n        `${css} ${selector_out} { ${opacity} animation-fill-mode: both; ` +\n        `animation-name: fadeOut; -webkit-animation-name: fadeOut; ` +\n        `animation-duration: 2s; -webkit-animation-duration: 2s; ` +\n        `}`;\n  }\n  return css;\n};\n\nconst InjectPaneFragment = (fragment, mode) => {\n  if (!validateSchema(fragment)) return <></>;\n  let this_id, css, child;\n\n  switch (mode) {\n    case \"MarkdownParagraph\":\n      this_id = `${fragment?.id}-paragraph`;\n      const paragraph = HtmlAstToReact(fragment);\n      css = `z-index: ${parseInt(fragment?.z_index)};`;\n      if (typeof fragment?.css?.parent === \"string\")\n        css = `${css} ${fragment?.css?.parent}`;\n      if (typeof fragment?.css?.child === \"string\")\n        css = `${css} ${fragment?.css?.child}`;\n      let composed = PaneFragment(this_id, paragraph, css);\n      // inject textShapeOutside(s) (if available)\n      if (\n        fragment?.payload?.maskData &&\n        Object.keys(fragment?.payload?.maskData).length &&\n        typeof fragment?.payload?.maskData?.textShapeOutside?.left_mask ===\n          \"string\" &&\n        typeof fragment?.payload?.maskData?.textShapeOutside?.right_mask ===\n          \"string\"\n      ) {\n        return (\n          <div className=\"paneFragmentParagraph\">\n            {fragment?.payload?.maskData?.textShapeOutside?.left}\n            {fragment?.payload?.maskData?.textShapeOutside?.right}\n            {composed}\n          </div>\n        );\n      }\n      // else render paragraph with shapeOutside\n      return <div className=\"paneFragmentParagraph\">{composed}</div>;\n\n    case \"Shape\":\n      this_id = `${fragment?.id}-svg-shape`;\n      css = `z-index: ${parseInt(fragment?.z_index)};`;\n      if (typeof fragment?.css?.parent === \"string\")\n        css = `${css} ${fragment?.css?.parent}`;\n      return PaneFragment(this_id, fragment?.payload?.shapeData, css);\n\n    case \"BackgroundImage\":\n      // always uses the first image only\n      this_id = `${fragment?.id}-background-image`;\n      const this_imageData = getImage(fragment?.payload?.imageData[0]?.data);\n      const bgImage = convertToBgImage(this_imageData);\n      css = `z-index: ${parseInt(\n        fragment?.z_index\n      )}; section { height:100%; } `;\n      if (typeof parent_css === \"string\")\n        css = `${css} img {${fragment?.css?.parent}; }`;\n      let this_object_fit = \"cover\";\n      let this_background_position =\n        fragment?.payload?.imageData[0]?.backgroundPosition || \"center\";\n      // TODO: background position isn't actually working\n      let child = (\n        <div className=\"paneFragmentImage\">\n          <BackgroundImage\n            Tag=\"section\"\n            style={{ backgroundPosition: this_background_position }}\n            {...bgImage}\n            objectFit={this_object_fit}\n            preserveStackingContext\n          >\n            <div className=\"paneFragmentImage__inner\">\n              <GatsbyImage\n                image={this_imageData}\n                alt={fragment?.payload?.imageData[0]?.alt_text}\n                style={{ backgroundPosition: this_background_position }}\n                objectFit={this_object_fit}\n              />\n            </div>\n          </BackgroundImage>\n        </div>\n      );\n      return PaneFragment(this_id, child, css);\n\n    case \"BackgroundVideo\":\n      this_id = `${fragment?.id}-background-video`;\n      css = `z-index: ${parseInt(\n        fragment?.z_index\n      )}; video{ object-fit: cover; } `;\n      if (typeof parent_css === \"string\")\n        css = `${css} ${fragment?.parent_css} `;\n      if (typeof child_css === \"string\") css = `${css} ${fragment?.child_css}`;\n      child = (\n        <video\n          autoPlay={true}\n          muted\n          loop\n          title={fragment?.payload?.videoData?.alt_text}\n          className=\"paneFragmentVideo\"\n        >\n          <source src={fragment?.payload?.videoData?.url} type=\"video/mp4\" />\n        </video>\n      );\n      return PaneFragment(this_id, child, css);\n\n    case \"SvgSource\":\n      this_id = `${fragment?.id}-svg`;\n      css = `z-index: ${parseInt(fragment?.z_index)};`;\n      if (typeof fragment?.css?.parent === \"string\")\n        css = `${css} ${fragment?.css?.parent}`;\n      child = (\n        <img\n          src={fragment?.payload?.imageData[0]?.url}\n          alt={fragment?.payload?.imageData[0]?.alt_text}\n          className=\"paneFragmentSvg\"\n        />\n      );\n      return PaneFragment(this_id, child, css);\n  }\n};\n\nconst hookControllerEndPoint = (target, payload, useHookEndPoint) => {\n  let mode;\n  switch (target) {\n    case \"impression-Visible\":\n      mode = \"Visible\"; // set icons and impressions to Visible\n    case \"impression-Hidden\":\n      if (!mode) mode = \"Hidden\"; // set icons and impressions to Hidden then None\n      /*\n  Object.keys(impressionsRaw).forEach((pane) => {\n    Object.keys(impressionsRaw[pane]).forEach((paneFragment) => {\n      Object.keys(impressionsRaw[pane][paneFragment]).forEach(\n        (impression, index) => {\n          let this_impression = impressionsRaw[pane][paneFragment][impression];\n          let title;\n          if (typeof this_impression?.wordmark === \"string\")\n            title = wordmark(this_impression?.wordmark);\n          impressions.push(\n            <div className=\"keen-slider__slide a\" key={index}>\n              {title}\n              <span>\n                {impressionsRaw[pane][paneFragment][impression]?.headline}\n              </span>\n            </div>\n          );\n        }\n      );\n    });\n  });\n  */\n      // first load ul from dom\n      let iconsMinimized = document.getElementById(\n        \"controller-minimized-icons\"\n      );\n      //let impressionsExpanded = document.getElementById(\"controller-carousel\");\n      let icon_count = iconsMinimized.getElementsByTagName(\"li\").length;\n      //let impression_count =\n      //  impressionsExpanded.getElementsByTagName(\"div\").length;\n      if (icon_count === 9) return null;\n      for (const this_uuid in payload) {\n        let payload_ast = lispLexer(payload[this_uuid]?.actionsLisp);\n        if (payload_ast && payload_ast[0]) {\n          // does this icon/impression exist already?\n          let this_icon = document.getElementById(`m-${this_uuid}`);\n          let this_icon_found = typeof this_icon === \"object\" && this_icon;\n          //let this_impression = document.getElementById(`${this_uuid}`);\n          //let this_impression_found =\n          //  typeof this_impression === \"object\" && this_impression;\n          /*\n          // add this impression to carousel\n          if (mode === \"Visible\") {\n            this_impression?.classList.add(\"visible\");\n            this_impression?.classList.remove(\"hidden\");\n            this_impression?.classList.remove(\"none\");\n          } else if (mode === \"Hidden\" && this_impression_found) {\n            this_impression?.classList.add(\"hidden\");\n            this_impression?.classList.remove(\"visible\");\n            setTimeout(function () {\n              this_impression?.classList.add(\"none\");\n            }, 1000);\n          }\n*/\n          // add this icon to container\n          if (mode === \"Visible\" && !this_icon_found) {\n            let this_icon_shape = icon(payload[this_uuid]?.icon);\n            let this_li = document.createElement(\"li\");\n            this_li.id = `m-${this_uuid}`;\n            this_li.title = payload[this_uuid]?.altTitle;\n            this_li.addEventListener(\"click\", function () {\n              lispCallback(payload_ast[0], \"\", useHookEndPoint);\n            });\n            this_li.classList.add(\"action\");\n            this_li.classList.add(\"visible\");\n            ReactDOM.render(this_icon_shape, this_li);\n            iconsMinimized.appendChild(this_li);\n          } else if (mode === \"Hidden\" && this_icon_found) {\n            this_icon.classList.remove(\"visible\");\n            this_icon.classList.add(\"hidden\");\n            setTimeout(function () {\n              this_icon.parentNode.removeChild(this_icon);\n            }, 1000);\n          }\n        }\n      }\n      // toggle default <> full class on icons lists depending on number of icons\n      icon_count = iconsMinimized.getElementsByTagName(\"li\").length;\n      if (icon_count > 4) {\n        iconsMinimized.classList.remove(\"default\");\n        iconsMinimized.classList.add(\"full\");\n      } else {\n        iconsMinimized.classList.remove(\"full\");\n        iconsMinimized.classList.add(\"default\");\n      }\n      break;\n\n    default:\n      return null;\n  }\n};\n\nconst HasImageMask = {\n  paragraph__background_video: \".paneFragmentVideo\",\n  paragraph__background_image: \".paneFragmentImage\",\n  paragraph__svg: \".paneFragmentSvg\",\n  paragraph__markdown: \".paneFragmentParagraph\",\n};\n\nconst HasPaneFragmentType = {\n  paragraph__markdown: \"MarkdownParagraph\",\n  paragraph__background_pane: \"Shape\",\n  paragraph__background_image: \"BackgroundImage\",\n  paragraph__background_video: \"BackgroundVideo\",\n  paragraph__svg: \"SvgSource\",\n  paragraph__d3: null,\n  paragraph__h5p: null,\n};\n\nexport {\n  InjectSvgModal,\n  InjectCssAnimation,\n  StyledWrapperDiv,\n  StyledWrapperSection,\n  PaneFragment,\n  HasImageMask,\n  HasPaneFragmentType,\n  InjectPaneFragment,\n  getStoryStepGraph,\n  lispCallback,\n  hookControllerEndPoint,\n  getScrollbarSize,\n  thisViewportValue,\n  viewportWidth,\n};\n"],"mappings":"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"}