{"version":3,"sources":["src/helpers.js"],"names":["React","sanitize","styled","graphql","useStaticQuery","Link","getImage","GatsbyImage","convertToBgImage","BackgroundImage","HtmlAstToReact","children","imageData","contents","fragment","map","e","index","type","value","tagName","breakout","p","i","replace","length","properties","href","pass","extcheck","src","match","this_imageData","filter","image","filename","localFile","childImageSharp","gatsbyImageData","alt","console","log","li","StyledWrapperDiv","div","props","css","StyledWrapperSection","section","PaneFragment","id","child","InjectSvg","url","alt_text","parent_css","zIndex","parseInt","InjectGatsbyBackgroundImage","bgImage","InjectGatsbyBackgroundVideo","child_css","MarkdownParagraph","htmlAst","paragraph","getStoryStepGraph","graph","targetId","edges","node"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { sanitize } from \"hast-util-sanitize\";\nimport styled from \"styled-components\";\nimport { graphql, useStaticQuery, Link } from \"gatsby\";\nimport { getImage, GatsbyImage } from \"gatsby-plugin-image\";\nimport { convertToBgImage } from \"gbimage-bridge\";\nimport BackgroundImage from \"gatsby-background-image\";\n\nconst HtmlAstToReact = (children, imageData = []) => {\n  // recursive function\n  // breaks gatsby images free of enclosing p tag\n  let contents;\n  const fragment = children.map((e, index) => {\n    if (e?.type === \"text\") return <span>{e?.value}</span>;\n    switch (e?.tagName) {\n      case \"h1\":\n        return <h1 key={index}>{e?.children[0].value}</h1>;\n      case \"h2\":\n        return <h2 key={index}>{e?.children[0].value}</h2>;\n      case \"h3\":\n        return <h3 key={index}>{e?.children[0].value}</h3>;\n      case \"h4\":\n        return <h4 key={index}>{e?.children[0].value}</h4>;\n      case \"h5\":\n        return <h5 key={index}>{e?.children[0].value}</h5>;\n      case \"h6\":\n        return <h6 key={index}>{e?.children[0].value}</h6>;\n\n      case \"p\":\n        let breakout = false;\n        contents = e?.children?.map((p, i) => {\n          if (p?.type === \"text\") {\n            let value = p?.value.replace(/\\r?\\n|\\r/g, \"\");\n            if (value.length) return <span key={i}>{value}</span>;\n          }\n          if (p?.type === \"element\") {\n            // determine which element ... could be p, img, br, a, ?\n            switch (p?.tagName) {\n              case \"br\":\n                return <br key={i} />;\n\n              case \"a\":\n                if (\n                  typeof p?.properties?.href === \"string\" &&\n                  p?.children[0]?.type === \"text\" &&\n                  typeof p?.children[0]?.value === \"string\"\n                ) {\n                  // is this an internal link?\n                  // TODO\n                  return (\n                    <Link to={p?.properties?.href} key={i}>\n                      {p?.children[0]?.value}\n                    </Link>\n                  );\n                }\n\n              case \"img\":\n                // is this case for gatsby image? = png, jpg ... != svg\n                let pass = /\\.[A-Za-z0-9]+$/;\n                let extcheck = p?.properties?.src?.match(pass);\n                if (\n                  extcheck &&\n                  (extcheck[0] === \".png\" || extcheck[0] === \".jpg\")\n                ) {\n                  // imageData in this case is an array ... must find correct element\n                  let this_imageData = imageData.filter(\n                    (image) => image.filename === p?.properties?.src\n                  )[0]?.localFile?.childImageSharp?.gatsbyImageData;\n                  breakout = true;\n                  return (\n                    <GatsbyImage\n                      key={i}\n                      alt={p?.properties?.alt}\n                      image={this_imageData}\n                    />\n                  );\n                }\n\n              default:\n                console.log(\"helpers.js: MISS on\", p?.tagName);\n            }\n            // use recursion to compose the MarkdownParagraph\n            return HtmlAstToReact(p?.children, imageData);\n          }\n        });\n        // breakout is true when contents is gatsby image\n        if (breakout) return <div key={index}>{contents}</div>;\n        return <p key={index}>{contents}</p>;\n\n      case \"ul\":\n        contents = e?.children?.map((li, i) => {\n          if (li?.type === \"element\") {\n            // assumes link contains text only\n            return <li key={i}>{li?.children[0].value}</li>;\n          }\n        });\n        return <ul key={index}>{contents}</ul>;\n\n      default:\n        console.log(\"helpers.js: MISS on\", e);\n    }\n  });\n  return <div>{fragment}</div>;\n};\n\nconst StyledWrapperDiv = styled.div`\n  ${(props) => props.css};\n`;\nconst StyledWrapperSection = styled.section`\n  ${(props) => props.css};\n`;\n\nconst PaneFragment = (id, child, css) => {\n  return (\n    <StyledWrapperDiv key={id} css={css}>\n      {child}\n    </StyledWrapperDiv>\n  );\n};\n\nconst InjectSvg = (id, url, alt_text, parent_css, zIndex) => {\n  let css = `${parent_css} z-index: ${parseInt(zIndex)};`;\n  let child = <img src={url} alt={alt_text} className=\"paneFragmentCSS\" />;\n  return PaneFragment(id, child, css);\n};\n\nconst InjectGatsbyBackgroundImage = (\n  id,\n  imageData,\n  alt_text,\n  parent_css = \"\",\n  zIndex\n) => {\n  const this_imageData = getImage(imageData);\n  const bgImage = convertToBgImage(this_imageData);\n\n  let css = `z-index: ${parseInt(zIndex)}; img { ${parent_css} }`;\n  let child = (\n    <BackgroundImage Tag=\"section\" {...bgImage} preserveStackingContext>\n      <div className=\"paneFragmentImage\">\n        <GatsbyImage image={this_imageData} alt={alt_text} />\n      </div>\n    </BackgroundImage>\n  );\n  return PaneFragment(id, child, css);\n};\n\nconst InjectGatsbyBackgroundVideo = (\n  id,\n  url,\n  alt_text,\n  parent_css = \"\",\n  child_css = \"\",\n  zIndex\n) => {\n  let css = `${parent_css} z-index: ${parseInt(zIndex)}; ${child_css}`;\n  let child = (\n    <video\n      autoPlay={true}\n      muted\n      loop\n      id={id}\n      title={alt_text}\n      className=\"paneFragmentVideo\"\n    >\n      <source src={url} type=\"video/mp4\" />\n    </video>\n  );\n  return PaneFragment(id, child, css);\n};\n\nconst MarkdownParagraph = (\n  id,\n  htmlAst,\n  imageData = [],\n  parent_css = \"\",\n  child_css = \"\",\n  zIndex\n) => {\n  const paragraph = HtmlAstToReact(htmlAst?.children, imageData);\n  const css = `${parent_css} z-index: ${parseInt(zIndex)}; ${child_css}`;\n  return PaneFragment(id, paragraph, css);\n};\n\nconst getStoryStepGraph = (graph, targetId) => {\n  return graph?.edges?.filter((e) => e?.node?.id === targetId)[0];\n};\n\nexport {\n  MarkdownParagraph,\n  InjectGatsbyBackgroundImage,\n  InjectGatsbyBackgroundVideo,\n  InjectSvg,\n  StyledWrapperDiv,\n  StyledWrapperSection,\n  getStoryStepGraph,\n};\n"],"file":"helpers.js"}