{"version":3,"file":"impressions.js","names":["React","useKeenSlider","wordmark","icon","lispLexer","lispCallback","ImpressionsIcons","props","iconsContainer","viewportKey","iconsMode","icons","impressionsRaw","payload","Object","keys","forEach","pane","activePanes","includes","paneFragment","impression","index","this_impression","this_icon","injectPayload","payload_ast","actionsLisp","useHookEndPoint","push","length","Slide","this_id","title","headline","hook","ImpressionsCarousel","slots","mobile","tablet","desktop","refCallback","slider","sliderNode","loop","mode","slides","perView","timeout","mouseOver","clearNextTimeout","clearTimeout","nextTimeout","setTimeout","next","on","container","addEventListener","impressions","emptySlots"],"sources":["src/impressions.js"],"sourcesContent":["import React from \"react\";\nimport \"keen-slider/keen-slider.min.css\";\nimport { useKeenSlider } from \"keen-slider/react\";\nimport { wordmark, icon } from \"./shapes\";\nimport { lispLexer } from \"./lexer\";\nimport { lispCallback } from \"./helpers\";\n\nconst ImpressionsIcons = (props) => {\n  let iconsContainer = `controller__icons controller__icons--${props?.viewportKey}`,\n    iconsMode,\n    icons = [];\n  let impressionsRaw = props?.payload;\n  if (impressionsRaw)\n    Object.keys(impressionsRaw).forEach((pane) => {\n      if (props?.activePanes?.includes(pane))\n        Object.keys(impressionsRaw[pane]).forEach((paneFragment) => {\n          Object.keys(impressionsRaw[pane][paneFragment]).forEach(\n            (impression, index) => {\n              let this_impression =\n                impressionsRaw[pane][paneFragment][impression];\n              let this_icon = icon(this_impression?.icon);\n              function injectPayload() {\n                let payload_ast = lispLexer(this_impression?.actionsLisp);\n                lispCallback(payload_ast[0], \"\", props?.useHookEndPoint);\n              }\n              icons.push(\n                <li\n                  key={index}\n                  className=\"action visible\"\n                  onClick={() => injectPayload()}\n                >\n                  {this_icon}\n                </li>\n              );\n            }\n          );\n        });\n    });\n  if (icons.length <= 4) iconsMode = \"default\";\n  else iconsMode = \"full\";\n\n  return (\n    <div className={iconsContainer}>\n      <ul className={iconsMode}>{icons}</ul>\n    </div>\n  );\n};\n\nconst Slide = (props) => {\n  return (\n    <div className=\"keen-slider__slide\" key={props?.this_id}>\n      <div className=\"title\">{props?.title}</div>\n      <div className=\"headline\">\n        {props?.headline}{\" \"}\n        <a className=\"more\" onClick={() => props?.hook()}>\n          Read&nbsp;&gt;\n        </a>\n      </div>\n    </div>\n  );\n};\n\nconst ImpressionsCarousel = (props) => {\n  const slots = {\n    mobile: 2,\n    tablet: 3,\n    desktop: 4,\n  };\n  const [refCallback, slider, sliderNode] = useKeenSlider(\n    {\n      loop: true,\n      mode: \"free-snap\",\n      slides: {\n        perView: `${slots[props?.viewportKey]}`,\n      },\n    },\n    [\n      (slider) => {\n        let timeout;\n        let mouseOver = false;\n        function clearNextTimeout() {\n          clearTimeout(timeout);\n        }\n        function nextTimeout() {\n          clearTimeout(timeout);\n          if (mouseOver) return;\n          timeout = setTimeout(() => {\n            slider.next();\n          }, 2200);\n        }\n        slider.on(\"created\", () => {\n          slider.container.addEventListener(\"mouseover\", () => {\n            mouseOver = true;\n            clearNextTimeout();\n          });\n          slider.container.addEventListener(\"mouseout\", () => {\n            mouseOver = false;\n            nextTimeout();\n          });\n          nextTimeout();\n        });\n        slider.on(\"dragStarted\", clearNextTimeout);\n        slider.on(\"animationEnded\", nextTimeout);\n        slider.on(\"updated\", nextTimeout);\n      },\n    ]\n  );\n\n  let impressions = [];\n  let impressionsRaw = props?.payload;\n  if (impressionsRaw)\n    Object.keys(impressionsRaw).forEach((pane) => {\n      if (props?.activePanes?.includes(pane))\n        Object.keys(impressionsRaw[pane]).forEach((paneFragment) => {\n          Object.keys(impressionsRaw[pane][paneFragment]).forEach(\n            (impression, index) => {\n              function injectPayload() {\n                let payload_ast = lispLexer(this_impression?.actionsLisp);\n                lispCallback(payload_ast[0], \"\", props?.useHookEndPoint);\n              }\n              let this_impression =\n                impressionsRaw[pane][paneFragment][impression];\n              let title;\n              if (typeof this_impression?.wordmark === \"string\")\n                title = wordmark(this_impression?.wordmark);\n              else title = this_impression?.title;\n              impressions.push(\n                Slide({\n                  this_id: this_impression?.icon,\n                  title: title,\n                  headline: this_impression?.headline,\n                  hook: injectPayload,\n                })\n              );\n            }\n          );\n        });\n    });\n  let title = wordmark(\"tractstack\");\n  impressions.push(\n    <div className=\"keen-slider__slide\" key=\"tractstack-${props?.viewportKey}\">\n      <div className=\"title\">{title}</div>\n      <div className=\"headline\">\n        Learning science powered product-market-fit finder for start-ups, brand\n        evangelists and community builders.\n      </div>\n    </div>\n  );\n\n  // add fillers\n  if (impressions.length < slots[props?.viewportKey]) {\n    let emptySlots = slots[props?.viewportKey] - impressions.length;\n    while (emptySlots) {\n      impressions.push(\n        <div\n          className=\"keen-slider__slide\"\n          key={`blank-${emptySlots}-${props?.viewportKey}`}\n        >\n          <div className=\"blank\">{emptySlots}</div>\n        </div>\n      );\n      emptySlots = emptySlots - 1;\n    }\n  }\n  return (\n    <div\n      id={`controller-carousel-${props?.viewportKey}`}\n      className={`keen-slider controller__container--carousel-${props?.viewportKey}`}\n      ref={refCallback}\n    >\n      {impressions}\n    </div>\n  );\n};\n\nexport { ImpressionsCarousel, ImpressionsIcons };\n"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,iCAAP;AACA,SAASC,aAAT,QAA8B,mBAA9B;AACA,SAASC,QAAT,EAAmBC,IAAnB,QAA+B,UAA/B;AACA,SAASC,SAAT,QAA0B,SAA1B;AACA,SAASC,YAAT,QAA6B,WAA7B;;AAEA,MAAMC,gBAAgB,GAAIC,KAAD,IAAW;EAClC,IAAIC,cAAc,GAAI,wCAAuCD,KAAK,EAAEE,WAAY,EAAhF;EAAA,IACEC,SADF;EAAA,IAEEC,KAAK,GAAG,EAFV;EAGA,IAAIC,cAAc,GAAGL,KAAK,EAAEM,OAA5B;EACA,IAAID,cAAJ,EACEE,MAAM,CAACC,IAAP,CAAYH,cAAZ,EAA4BI,OAA5B,CAAqCC,IAAD,IAAU;IAC5C,IAAIV,KAAK,EAAEW,WAAP,EAAoBC,QAApB,CAA6BF,IAA7B,CAAJ,EACEH,MAAM,CAACC,IAAP,CAAYH,cAAc,CAACK,IAAD,CAA1B,EAAkCD,OAAlC,CAA2CI,YAAD,IAAkB;MAC1DN,MAAM,CAACC,IAAP,CAAYH,cAAc,CAACK,IAAD,CAAd,CAAqBG,YAArB,CAAZ,EAAgDJ,OAAhD,CACE,CAACK,UAAD,EAAaC,KAAb,KAAuB;QACrB,IAAIC,eAAe,GACjBX,cAAc,CAACK,IAAD,CAAd,CAAqBG,YAArB,EAAmCC,UAAnC,CADF;QAEA,IAAIG,SAAS,GAAGrB,IAAI,CAACoB,eAAe,EAAEpB,IAAlB,CAApB;;QACA,SAASsB,aAAT,GAAyB;UACvB,IAAIC,WAAW,GAAGtB,SAAS,CAACmB,eAAe,EAAEI,WAAlB,CAA3B;UACAtB,YAAY,CAACqB,WAAW,CAAC,CAAD,CAAZ,EAAiB,EAAjB,EAAqBnB,KAAK,EAAEqB,eAA5B,CAAZ;QACD;;QACDjB,KAAK,CAACkB,IAAN,eACE;UACE,GAAG,EAAEP,KADP;UAEE,SAAS,EAAC,gBAFZ;UAGE,OAAO,EAAE,MAAMG,aAAa;QAH9B,GAKGD,SALH,CADF;MASD,CAlBH;IAoBD,CArBD;EAsBH,CAxBD;EAyBF,IAAIb,KAAK,CAACmB,MAAN,IAAgB,CAApB,EAAuBpB,SAAS,GAAG,SAAZ,CAAvB,KACKA,SAAS,GAAG,MAAZ;EAEL,oBACE;IAAK,SAAS,EAAEF;EAAhB,gBACE;IAAI,SAAS,EAAEE;EAAf,GAA2BC,KAA3B,CADF,CADF;AAKD,CAvCD;;AAyCA,MAAMoB,KAAK,GAAIxB,KAAD,IAAW;EACvB,oBACE;IAAK,SAAS,EAAC,oBAAf;IAAoC,GAAG,EAAEA,KAAK,EAAEyB;EAAhD,gBACE;IAAK,SAAS,EAAC;EAAf,GAAwBzB,KAAK,EAAE0B,KAA/B,CADF,eAEE;IAAK,SAAS,EAAC;EAAf,GACG1B,KAAK,EAAE2B,QADV,EACoB,GADpB,eAEE;IAAG,SAAS,EAAC,MAAb;IAAoB,OAAO,EAAE,MAAM3B,KAAK,EAAE4B,IAAP;EAAnC,eAFF,CAFF,CADF;AAWD,CAZD;;AAcA,MAAMC,mBAAmB,GAAI7B,KAAD,IAAW;EACrC,MAAM8B,KAAK,GAAG;IACZC,MAAM,EAAE,CADI;IAEZC,MAAM,EAAE,CAFI;IAGZC,OAAO,EAAE;EAHG,CAAd;EAKA,MAAM,CAACC,WAAD,EAAcC,MAAd,EAAsBC,UAAtB,IAAoC1C,aAAa,CACrD;IACE2C,IAAI,EAAE,IADR;IAEEC,IAAI,EAAE,WAFR;IAGEC,MAAM,EAAE;MACNC,OAAO,EAAG,GAAEV,KAAK,CAAC9B,KAAK,EAAEE,WAAR,CAAqB;IADhC;EAHV,CADqD,EAQrD,CACGiC,MAAD,IAAY;IACV,IAAIM,OAAJ;IACA,IAAIC,SAAS,GAAG,KAAhB;;IACA,SAASC,gBAAT,GAA4B;MAC1BC,YAAY,CAACH,OAAD,CAAZ;IACD;;IACD,SAASI,WAAT,GAAuB;MACrBD,YAAY,CAACH,OAAD,CAAZ;MACA,IAAIC,SAAJ,EAAe;MACfD,OAAO,GAAGK,UAAU,CAAC,MAAM;QACzBX,MAAM,CAACY,IAAP;MACD,CAFmB,EAEjB,IAFiB,CAApB;IAGD;;IACDZ,MAAM,CAACa,EAAP,CAAU,SAAV,EAAqB,MAAM;MACzBb,MAAM,CAACc,SAAP,CAAiBC,gBAAjB,CAAkC,WAAlC,EAA+C,MAAM;QACnDR,SAAS,GAAG,IAAZ;QACAC,gBAAgB;MACjB,CAHD;MAIAR,MAAM,CAACc,SAAP,CAAiBC,gBAAjB,CAAkC,UAAlC,EAA8C,MAAM;QAClDR,SAAS,GAAG,KAAZ;QACAG,WAAW;MACZ,CAHD;MAIAA,WAAW;IACZ,CAVD;IAWAV,MAAM,CAACa,EAAP,CAAU,aAAV,EAAyBL,gBAAzB;IACAR,MAAM,CAACa,EAAP,CAAU,gBAAV,EAA4BH,WAA5B;IACAV,MAAM,CAACa,EAAP,CAAU,SAAV,EAAqBH,WAArB;EACD,CA5BH,CARqD,CAAvD;EAwCA,IAAIM,WAAW,GAAG,EAAlB;EACA,IAAI9C,cAAc,GAAGL,KAAK,EAAEM,OAA5B;EACA,IAAID,cAAJ,EACEE,MAAM,CAACC,IAAP,CAAYH,cAAZ,EAA4BI,OAA5B,CAAqCC,IAAD,IAAU;IAC5C,IAAIV,KAAK,EAAEW,WAAP,EAAoBC,QAApB,CAA6BF,IAA7B,CAAJ,EACEH,MAAM,CAACC,IAAP,CAAYH,cAAc,CAACK,IAAD,CAA1B,EAAkCD,OAAlC,CAA2CI,YAAD,IAAkB;MAC1DN,MAAM,CAACC,IAAP,CAAYH,cAAc,CAACK,IAAD,CAAd,CAAqBG,YAArB,CAAZ,EAAgDJ,OAAhD,CACE,CAACK,UAAD,EAAaC,KAAb,KAAuB;QACrB,SAASG,aAAT,GAAyB;UACvB,IAAIC,WAAW,GAAGtB,SAAS,CAACmB,eAAe,EAAEI,WAAlB,CAA3B;UACAtB,YAAY,CAACqB,WAAW,CAAC,CAAD,CAAZ,EAAiB,EAAjB,EAAqBnB,KAAK,EAAEqB,eAA5B,CAAZ;QACD;;QACD,IAAIL,eAAe,GACjBX,cAAc,CAACK,IAAD,CAAd,CAAqBG,YAArB,EAAmCC,UAAnC,CADF;QAEA,IAAIY,KAAJ;QACA,IAAI,OAAOV,eAAe,EAAErB,QAAxB,KAAqC,QAAzC,EACE+B,KAAK,GAAG/B,QAAQ,CAACqB,eAAe,EAAErB,QAAlB,CAAhB,CADF,KAEK+B,KAAK,GAAGV,eAAe,EAAEU,KAAzB;QACLyB,WAAW,CAAC7B,IAAZ,CACEE,KAAK,CAAC;UACJC,OAAO,EAAET,eAAe,EAAEpB,IADtB;UAEJ8B,KAAK,EAAEA,KAFH;UAGJC,QAAQ,EAAEX,eAAe,EAAEW,QAHvB;UAIJC,IAAI,EAAEV;QAJF,CAAD,CADP;MAQD,CApBH;IAsBD,CAvBD;EAwBH,CA1BD;EA2BF,IAAIQ,KAAK,GAAG/B,QAAQ,CAAC,YAAD,CAApB;EACAwD,WAAW,CAAC7B,IAAZ,eACE;IAAK,SAAS,EAAC,oBAAf;IAAoC,GAAG,EAAC;EAAxC,gBACE;IAAK,SAAS,EAAC;EAAf,GAAwBI,KAAxB,CADF,eAEE;IAAK,SAAS,EAAC;EAAf,iHAFF,CADF,EA7EqC,CAuFrC;;EACA,IAAIyB,WAAW,CAAC5B,MAAZ,GAAqBO,KAAK,CAAC9B,KAAK,EAAEE,WAAR,CAA9B,EAAoD;IAClD,IAAIkD,UAAU,GAAGtB,KAAK,CAAC9B,KAAK,EAAEE,WAAR,CAAL,GAA4BiD,WAAW,CAAC5B,MAAzD;;IACA,OAAO6B,UAAP,EAAmB;MACjBD,WAAW,CAAC7B,IAAZ,eACE;QACE,SAAS,EAAC,oBADZ;QAEE,GAAG,EAAG,SAAQ8B,UAAW,IAAGpD,KAAK,EAAEE,WAAY;MAFjD,gBAIE;QAAK,SAAS,EAAC;MAAf,GAAwBkD,UAAxB,CAJF,CADF;MAQAA,UAAU,GAAGA,UAAU,GAAG,CAA1B;IACD;EACF;;EACD,oBACE;IACE,EAAE,EAAG,uBAAsBpD,KAAK,EAAEE,WAAY,EADhD;IAEE,SAAS,EAAG,+CAA8CF,KAAK,EAAEE,WAAY,EAF/E;IAGE,GAAG,EAAEgC;EAHP,GAKGiB,WALH,CADF;AASD,CA/GD;;AAiHA,SAAStB,mBAAT,EAA8B9B,gBAA9B"}